[우아콘2023-대규모 트랜잭션을 처리하는 배민 주문시스템 규모에 따른 진화](https://www.youtube.com/watch?v=704qQs6KoUk)를 보고 정리한 글

# 조회와 쓰기 작업용 DB 분리
루트 엔티티 기반으로 여러 엔티티로 구성된 애그리거트: 도메인 주도 설계에서 사용되는 용어 같다.
간단히 이해하자면, 루트 엔티티는 중심 역할의 테이블이고 다른 엔티티는 정규화된 부수적인 테블들이다.
예를 들어, 경매 테이블이 루트 엔티티라면 이에 기반한 다른 엔티티들은 경매 내역 테이블, 이미지 테이블이다.
## 조회와 쓰기용 DB를 분리한 이유
RDBMS는 하나의 도메인(애그리거트)에 대해서 정규화된 여러 테이블을 조인하게되면 조회 성능이 나빠진다.

 > [!tip] 조회 성능을 높이기 위해 루트 엔티티 기반으로 구성된 애그리거트를 역정규화를 통해 단일 도큐먼트로 만든다.
 
 NoSQL인 mongoDB를 사용할 수 있다.
 이 경우 단순 id 값만으로 필요한 모든 데이트를 한번에 쿼리할 수 있다.
## 동기화 방법
도메인의 생명주기를 먼저 파악해야한다.
경매는 경매(글) 생성(수정) -> 입찰 -> 낙찰 -> 경매 종료의 라이프사이클을 가진다.

**도메인 라이프사이클 안에서만 데이터의 변경이 일어난다.**

![[우아콘2023_데이터_동기화.png]]
1. 주문 API에서 주문 도메인 내 데이터 변경 발생
2. 주문 이벤트 발행
3. 주문이벤트 처리 애플리케이션에서 데이터 동기화
4. mongoDB에 데이터 실시간으로 공