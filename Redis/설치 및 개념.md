# 설치
```bash
docker pull redis:6.2
```
# in-memory 데이터베이스 특징
- 밀리세컨드 단위의 빠른 응답 속도와 높은 처리량 -> 대용량 트래픽 서비스의 캐시 서버로 활용
- RAM 활용 -> 휘발성 데이터 -> 가용성 고려해야함
- 다양한 데이터 타입 및 자료구조 지원: string, hashtable, b-tree
# Remote Dictionary Server(Redis)
- in-memory 데이터베이스
- key-value 형식의 데이터 저장
- 메모리에 있는 데이터를 디스크에 저장할 수 있음
	- RDB: 특정 시점에 스냅샷을 찍어 전체 DB를 디스크에 저장, 메모리 사용률이 급증할 수 있어 모니터링해야함
	- AOF(Append Only File): 데이터 쓰기 명령어 적재, 복구 용이, 용량 커짐, 디스크에 쓰기 많이 해서 성능 영향
- 기본적으로 RDB, AOF 둘 중 하나나 둘다 또는 저장 없이 캐시 용도로만 사용할 수도 있음
- Strings, Lists, Sets, Hashes, Sorted sets 등 다양한 데이터 타입 저장 가능
- 클라이언트로부터 전달 받은 명령을 **싱글 스레드**로 처리

> [!NOTE] 싱글 스레드? 
> - 동시에 여러 명령어를 처리하지 않고 들어온 요청 순서대로 한번에 하나의 명령어 처리
> - 싱글 스레드 구조는 내부적으로 lock을 사용하지 않아도 원자적 실행 가능하고, 이를 통해 데이터 일관성 보장
> - 병렬 처리보다 단순함
> - 앞의 명령어를 처리하는데 오랜 시간이 걸리면 뒤 명령어들이 대기하면서 응답 속도 지연이 발생해 서비스 장애 발생 가능

- redis 공식문서에서 명령어들마다 big-O 알려주며, O(n)은 주의해야함
- redis v6.0 부터 멀티 스레드 i/o 도입: 명령 처리 부분과 i/o사이에 지연이 일어나지 않도록 i/o 부분에 별도의 스레드 지정 가능, 네트워크 in/out, 병렬 처리 가능
## redis 활용 사례
- 캐시 서버, 세션 스토어
- Pub/Sub: 메세지 발행(publish), 메세지 구독(subscribe)으로 서버간 메세지 주고 받음, 웹 어플리케이션은 비동기 처리, 실시간 채팅 가능
- Message queue: 메세지를 redis에 저장하고 해당 메세지를 필요로하는 서버에서 메세지를 요청하면 요청한 순서대로 메세지를 가져감 
# redis 실행 방법(docker)
도커 이미지 실행 방법과 같음
```bash
# -d 붙이면 백그라운드 실행
docker run --rm -it -d [IMAGE:VERSION]
docker run --rm -it redis:6.2
```

실행중인 컨테이너 확인하기
```bash
docker ps
```

도커 컨테이너를 외부 네트워크와 연결하는 방법
```bash
docker run --rm -it -d -p [PORT: PORT] [IMAGE:VERSION]
```

컨테이너 종료
```bash
docker kill [Container ID]
```
# Redis CLI
redis CLI 실행
```bash
docker exec -it [Container ID] redis-cli
```

redis로 전달된 명령이 적절한 명령어로 수행되는지 모니터링하기
```bash
docker exec -it [Container ID] redis-cli monitor
```

10ms 이상 소요된 명령어들 확인
```cli
slowlog get

1) ID
2) 실행시간
3) 수행시간(ms)
4) 명령
5) client ip/port
6) client name
```

설정 정보
```cli
info
```

메모리 사용률, 클라이언트 접속 수 블락된 수, 요청 수 등 redis 리소스 확인
```bash
docker exec -it [Container ID] redis-cli --stat
```

성능 테스트
1. 컨테이너로 접속
```bash
docker exec -it [container id] /bin/bash
```

2. 성능테스트 명령어 실행
```cli
redis-benchmark
```

숫자로 데이터베이스 구분, 다른 데이터베이스의 데이터 조회 못함
```cli
:6379> SELECT 0
:6379> SELECT 1
:6379[1]> SELECT 2
```

redisinsight: redis GUI 
# Redis 명령어
- `SET`: 데이터 저장
- key에 구분자를 넣어서 지정 가능
```cli
SET users:1:email siwoli@gmail.com 
```
users 중에 id가 1번인 key에 email 값이라는 의미

- `SETNX`: (SET IF NOT EXIST)데이터가 없을 경우

- `GET`: 하나의 데이터 조회

- `MGET`: 여러 데이터 조회
```cli
mget users:1:email gender name age
```
users중 id가 1번인 것의 email, gender, name, age 조회
> [!tip] 여러 key들의 value가 필요할때 `MGET`으로 한번에 가져오는게 성능 더 좋음

- `INC [key]`: value 1 증가
- `INCRBY [key] [increment]`: value가 `increment`값만큼 증가