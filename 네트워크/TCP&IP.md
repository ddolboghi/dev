---
aliases:
  - TCP/IP
---
# TCP/IP 프로토콜 스택
TCP와 IP는 별도 계층에서 동작하는 프로토콜이지만 대부분 함께 사용합니다.
이런 프로토콜 묶음을 프로토콜 스택이라고 부릅니다.

TCP/IP 프로토콜 스택은 총 4개 부분으로 나뉩니다.
![[tcpip_protocol_stack | 500]]
# OSI(Open Systems Interconnection) 모델
- 개방형 상호접속시스템 모델
- 컴퓨터 시스템의 기술적 통신 특성을 표준화한 개념적 모델이다.
- OSI 모델에서 각 계층은 자신보다 하위 계층의 기능을 이용할 수 있다.
- 하위 계층은 상위 계층이 사용할 수 있는 기능을 제공한다.
- 하위 계층은 하드웨어에 가깝고, 상위 계층은 소프트웨어에 가깝다.
## Physical 계층
- Physical 계층은 들어온 전기 신호를 그대로 잘 전달하는 것이 목적입니다.
- 1계층 장비는 주소의 개념이 없으므로 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송합니다.
## Data Link 계층
- 전기 신호를 모아 우리가 알아볼 수 있는 데이터 형태로 처리합니다.
- 주소 정보를 정의하고 정확한 주소로 통신되도록 합니다.
- 이더넷 기반 네트워크의 2계층에서는 에러를 탐지하는 역할만 수행합니다.
- 받는 사람이 현재 데이터를 받을 수 있는지 확인하는 작업인 flow control을 합니다.
- 2계층 장비로는 네트워크 인터페이스 카드(NIC)와 스위치가 있습니다.
- NIC에는 고유 MAC 주소가 있습니다.
- NIC는 데이터에서 도착지 MAC 주소를 확인 후 자신에게 들어오는 전기 신호가 아니면 버리고, 맞으면 메모리에 적재합니다.
- 스위치는 MAC 주소 테이블을 보고 정확한 포트로 포워딩해줍니다.
- 스위치의 적절한 필터링과 포워딩 기능으로 통신이 필요한 포트만 사용하고 네트워크 전체에 불필요한 처리가 감소하면서 이더넷 네트워크 효율성이 크게 향상되었습니다.
## Network 계층
- IP 주소같은 논리적인 주소가 정의됩니다.
- IP 주소는 사용자가 환경에 맞게 변경 가능합니다.
- 3계층 장비인 라우터는 IP 주소를 사용해 최적의 경로를 찾아주고 해당 경로로 패킷을 전송합니다.
## Transport 계층
- 데이터들이 정상적으로 잘 보내지도록 확인합니다.
### 패킷 네트워크
- 패킷 네트워크는 데이터를 분할해 패킷에 실어보내다 보니 중간에 패킷이 유실되거나 순서가 바뀔수 있습니다.
- 4계층에서 패킷을 분할할때 패킷 헤더에 보내는 순서(**Sequence Number**)와 받는 순서(**ACKnowledgement Number**)를 적어 통신하므로 패킷이 유실되면 재전송을 요청할 수 있고, 순서도 바로잡을 수 있습니다.
- **Port Number**를 사용해 상위 애플리케이션을 구분합니다.
- 4계층 장비는 로드 밸런서와 방화벽이 있습니다.
## Session 계층
- 우리가 흔히 부르는 '세션'을 관리합니다.
- TCP/IP 세션을 만들고 없앱니다.
- 에러로 중단된 통신에 대한 에러 복구와 재전송도 수행합니다.
## Presentation 계층
- 데이터를 하나의 통일된 구문 형식으로 변환합니다.
- MIME 인코딩, 암호화, 압축, 코드 변환 등을 합니다.
## Application 계층
- 애플리케이션 서비스를 수행합니다.
- 대표적인 프로토콜로는 FTP, SMTP, HTTP, TELNET이 있습니다.
# Encapsulation & Decapsulation
Encapsulation은 애플리케이션에서 데이터를 Data Flow 계층(1 - 4계층)으로 내려보내면서 패킷에 데이터를 넣을 수 있도록 분할하는 과정입니다.
- 계층을 지나면서 각 계층 헤더가 패킷에 추가됩니다.
- 현재 계층에서 추가하는 헤더 정보는 받는 상대방의 계층에서 확인해야 할 정보입니다.
- 헤더에는
	1. 현재 계층에서 정의하는 정보
	2. 상위 프로토콜 지시자
	가 반드시 포함되어야 합니다.
- encapsulation 과정에서 상위 프로토콜이 많아도 문제가 없지만 헤더에 상위 프로토콜 지시자 정보가 없다면, decapsulation하는 과정에서 어떤 상위 프로토콜로 올려보내 주어야 할지 결정할 수 없습니다.
- 상위 프로토콜 지시자 정보는 상위 계층의 프로토콜이므로 현재 계층보다 한 계층 위의 정보가 적힙니다.

Decapsulation은 받은 전기 신호를 변환한 패킷을 조합해 데이터로 만듭니다.
- 각 계층마다 Encapsulation시 추가된 헤더 정보로 자신에게 온 패킷이 아니라면 버리고, 자신에게 온것이 맞다면 해당 계층의 헤더 정보를 제거하고 상위 계층으로 올려보냅니다.
# MSS & MTU
MSS(Maximum Segment Size): 데이터가 4계층으로 내려올때 적절히 쪼개질 크기
MTU(Maximun Transmission Unit): 네트워크에서 한 번에 보낼 수 있는 데이터 크기
- 일반적인 이더넷의 MTU는 1500 byte입니다.