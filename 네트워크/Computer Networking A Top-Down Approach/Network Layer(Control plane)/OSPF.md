# Autonomous System
- 규모 문제: 인터넷 네트워크 규모는 라우터에 라우팅 정보를 저장하고, 경로 계산에 막대한 오버헤드가 발생한다.
- 관리 자치성 문제: ISP는 네트워크 내부를 숨기면서 원하는 대로 네트워크를 운영하고 관리할 수 있어야 한다.
- 이 두 가지 문제는 라우터를 자율 시스템(Autonomous System, AS)으로 조직하여 해결될 수 있다.
- 자율 시스템은 **동일한 관리 제어하에 있는 라우터 그룹**으로 구성된다.
- AS는 전 세계적으로 고유한 자율 시스템 번호(Autonomous System Number, ASN)로 식별된다.
- 동일한 AS 내의 라우터들은 모두 동일한 라우팅 알고리즘을 실행하며 서로에 대한 정보를 가지고 있다.
- 자율 시스템 내에서 실행되는 라우팅 알고리즘을 **AS 내부 라우팅 프로토콜(intra-autonomous system routing protocol)** 이라고 한다.
# OSPF (Open Shortest Path First)
- OSPF는 링크 상태 정보의 플러딩(flooding)과 다익스트라의 최소 비용 경로 알고리즘을 사용하는 링크 상태(link-state) 프로토콜이다.
- OSPF의 'Open'은 라우팅 프로토콜 명세가 공개적으로 사용 가능하다는 것을 나타낸다.
- OSPF를 사용하면, 각 라우터는 전체 자율 시스템의 완전한 토폴로지 맵(즉, 그래프)을 구성한다.
- 그런 다음 각 라우터는 로컬에서 다익스트라의 최단 경로 알고리즘을 실행하여 자신을 루트 노드로 하는 모든 서브넷까지의 최단 경로 트리를 결정한다.
- 관리자는 원하는 방법으로 개별 링크 비용을 설정할 수 있다.
- OSPF를 사용하면 **라우터는 이웃 라우터뿐만 아니라 자율 시스템 내의 모든 다른 라우터에게 라우팅 정보를 브로드캐스트**한다.
- 라우터는 링크 상태에 변화가 있거나, 또는 주기적으로 링크 상태를 브로드캐스트한다.
- OSPF 프로토콜은 링크가 작동 중인지 확인한다.
## OSPF의 고급 기능들
- 보안: OSPF 라우터 간의 교환은 인증을 통해 신뢰할 수 있는 라우터만이 AS 내의 OSPF 프로토콜에 참여할 수 있으므로, 악의적인 침입자가 라우터 테이블에 잘못된 정보를 주입하는 것을 방지할 수 있다. 기본적으로 라우터 간 OSPF 패킷은 인증되지 않아 위조될 수 있다. 두 가지 유형의 인증(단순 인증과 MD5 인증)을 구성할 수 있다.
- 다중 동일 비용 경로: 목적지까지 여러 경로의 비용이 동일할 때, OSPF는 여러 경로를 사용할 수 있도록 허용한다.
- 유니캐스트 및 멀티캐스트 라우팅의 통합 지원: 멀티캐스트 OSPF(MOSPF)는 기존 OSPF 링크 데이터베이스를 사용하고 새로운 유형의 링크 상태 브로드캐스팅을 기존 OSPF 링크 상태 브로드캐스트 메커니즘에 추가한다.
- 단일 AS 내 계층 구조 지원: 
	- OSPF 자율 시스템은 계층적으로 **영역**으로 구성될 수 있다. 각 영역은 자체 OSPF 링크 상태 라우팅 알고리즘을 실행한다.
	- 각 영역 내에서 하나 이상의 **영역 경계 라우터**가 영역 외부로 패킷을 보내야 한다.
	- 단 하나의 OSPF 영역이 **백본(backbone) 영역**으로 구성된다.
	- 백본 영역은 AS 내 다른 영역들 간의 트래픽을 라우팅한다.
	- 백본은 항상 AS 내 모든 영역 경계 라우터를 포함하며, 경계 라우터가 아닌 라우터도 포함할 수 있다.
	- AS 내에서 영역 간 라우팅은 패킷이 먼저 영역 경계 라우터로 라우팅된 다음(영역 내부 라우팅), 백본을 통해 목적지 영역에 있는 영역 경계 라우터로 라우팅된 후, 최종 목적지로 라우팅되어야 한다.

## OSPF 링크 가중치 설정
OSPF에서 링크 가중치(Link Weight)를 설정하는 것은 단순히 '링크의 비용'을 정하는 것을 넘어, 네트워크 관리자가 **원하는 대로 트래픽 흐름을 유도하는** 중요한 도구다.
### 기본 관점: 가중치가 경로를 결정한다
일반적으로 링크 가중치는 링크의 성능을 나타낸다. 예를 들어, 네트워크 관리자는 다음과 같이 설정할 수 있다.
- 빠른 링크 (고대역폭) → 낮은 가중치 (비용이 적음)
- 느린 링크 (저대역폭) → 높은 가중치 (비용이 비쌈)

이렇게 설정하면, OSPF 알고리즘은 가장 저렴한 경로, 즉 **가중치의 합이 가장 낮은 경로를 최적 경로로 자동 계산**한다. 이것이 가장 직관적이고 기본적인 OSPF의 작동 방식이다.
### 트래픽 엔지니어링 관점: 원하는 경로에 맞춰 가중치를 역설계한다
실제 네트워크 운영에서는 트래픽 엔지니어링 목표가 있다. 예를 들어, "어떤 특정 링크 하나만 너무 바빠지지 않도록 트래픽을 골고루 분산시키고 싶다"와 같은 목표다.
이 경우, 관리자의 생각의 순서가 바뀐다.
1. **목표 설정**: "A에서 B로 가는 트래픽은 1번 경로로, C에서 D로 가는 트래픽은 2번 경로로 보내서 네트워크 전체의 혼잡을 최소화해야겠다" 와 같이 **원하는 트래픽 흐름을 먼저 설계**한다.
2. **가중치 역설계**: 그 다음, OSPF 알고리즘이 **정확히 그 설계된 경로를 '최적 경로'라고 계산하도록** 링크 가중치 값을 역으로 찾아 설정합니다. 즉, 결과(원하는 경로)를 먼저 정하고, 그 결과를 만들어낼 원인(링크 가중치)을 끼워 맞춘다.

여러 친구 그룹이 각자 차를 몰고 파티 장소로 온다고 상상해보자. 특정 그룹은 1번 국도, 다른 그룹은 2번 고속도로를 이용하게 해서 교통 체증을 피하고 싶다.
이때 친구들에게 직접 "1번 국도로 가세요"라고 말하는 대신, 모든 친구가 사용하는 **내비게이션 앱의 도로 정보를 조작**한다. 1번 국도의 통행료를 매우 싸게, 2번 고속도로의 통행료는 다른 길보다 약간 비싸게 설정하는 식이다.
그러면 친구들은 그저 "가장 싼 길"을 따라 내비게이션을 켰을 뿐이지만, 결과적으로는 **당신이 의도한 경로로 정확히 움직이게 된다.** 이것이 바로 OSPF 링크 가중치를 이용한 트래픽 엔지니어링의 핵심 원리다.