# Autonomous System
- 규모 문제: 인터넷 네트워크 규모는 라우터에 라우팅 정보를 저장하고, 경로 계산에 막대한 오버헤드가 발생한다.
- 관리 자치성 문제: ISP는 네트워크 내부를 숨기면서 원하는 대로 네트워크를 운영하고 관리할 수 있어야 한다.
- 이 두 가지 문제는 라우터를 자율 시스템(Autonomous System, AS)으로 조직하여 해결될 수 있다.
- 자율 시스템은 **동일한 관리 제어하에 있는 라우터 그룹**으로 구성된다.
- AS는 전 세계적으로 고유한 자율 시스템 번호(Autonomous System Number, ASN)로 식별된다.
- 동일한 AS 내의 라우터들은 모두 동일한 라우팅 알고리즘을 실행하며 서로에 대한 정보를 가지고 있다.
- 자율 시스템 내에서 실행되는 라우팅 알고리즘을 **AS 내부 라우팅 프로토콜(intra-autonomous system routing protocol)** 이라고 한다.
# OSPF (Open Shortest Path First)
- OSPF는 링크 상태 정보의 플러딩(flooding)과 다익스트라의 최소 비용 경로 알고리즘을 사용하는 링크 상태(link-state) 프로토콜이다.
- OSPF의 'Open'은 라우팅 프로토콜 명세가 공개적으로 사용 가능하다는 것을 나타낸다.
- OSPF를 사용하면, 각 라우터는 전체 자율 시스템의 완전한 토폴로지 맵(즉, 그래프)을 구성한다.
- 그런 다음 각 라우터는 로컬에서 다익스트라의 최단 경로 알고리즘을 실행하여 자신을 루트 노드로 하는 모든 서브넷까지의 최단 경로 트리를 결정한다.
- 관리자는 원하는 방법으로 개별 링크 비용을 설정할 수 있다.
- OSPF를 사용하면 **라우터는 이웃 라우터뿐만 아니라 자율 시스템 내의 모든 다른 라우터에게 라우팅 정보를 브로드캐스트**한다.
- 라우터는 링크 상태에 변화가 있거나, 또는 주기적으로 링크 상태를 브로드캐스트한다.
- OSPF 프로토콜은 링크가 작동 중인지 확인한다.
## OSPF의 고급 기능들
- 보안: OSPF 라우터 간의 교환은 인증을 통해 신뢰할 수 있는 라우터만이 AS 내의 OSPF 프로토콜에 참여할 수 있으므로, 악의적인 침입자가 라우터 테이블에 잘못된 정보를 주입하는 것을 방지할 수 있다. 기본적으로 라우터 간 OSPF 패킷은 인증되지 않아 위조될 수 있다. 두 가지 유형의 인증(단순 인증과 MD5 인증)을 구성할 수 있다.
- 다중 동일 비용 경로: 목적지까지 여러 경로의 비용이 동일할 때, OSPF는 여러 경로를 사용할 수 있도록 허용한다.
- 유니캐스트 및 멀티캐스트 라우팅의 통합 지원: 멀티캐스트 OSPF(MOSPF)는 기존 OSPF 링크 데이터베이스를 사용하고 새로운 유형의 링크 상태 브로드캐스팅을 기존 OSPF 링크 상태 브로드캐스트 메커니즘에 추가한다.
- 단일 AS 내 계층 구조 지원: 
	- OSPF 자율 시스템은 계층적으로 **영역**으로 구성될 수 있다. 각 영역은 자체 OSPF 링크 상태 라우팅 알고리즘을 실행한다.
	- 각 영역 내에서 하나 이상의 **영역 경계 라우터**가 영역 외부로 패킷을 보내야 한다.
	- 단 하나의 OSPF 영역이 **백본(backbone) 영역**으로 구성된다.
	- 백본 영역은 AS 내 다른 영역들 간의 트래픽을 라우팅한다.
	- 백본은 항상 AS 내 모든 영역 경계 라우터를 포함하며, 경계 라우터가 아닌 라우터도 포함할 수 있다.
	- AS 내에서 영역 간 라우팅은 패킷이 먼저 영역 경계 라우터로 라우팅된 다음(영역 내부 라우팅), 백본을 통해 목적지 영역에 있는 영역 경계 라우터로 라우팅된 후, 최종 목적지로 라우팅되어야 한다.

## OSPF 링크 가중치 설정
링크 상태 라우팅에 대한 논의는 링크 가중치가 설정되고, OSPF와 같은 라우팅 알고리즘이 실행되며, LS 알고리즘에 의해 계산된 라우팅 테이블에 따라 트래픽이 흐른다는 것을 암묵적으로 가정했다.
이 관점에서 링크 가중치는 링크 사용 비용을 반영하며(e.g. 링크 가중치가 용량에 반비례한다면, 고용량 링크 사용은 가중치가 낮아져 라우팅 관점에서 더 매력적), 다익스트라 알고리즘은 전체 비용을 최소화하는 역할을 한다.

그러나 **실제로는 링크 가중치와 라우팅 경로 간의 인과 관계가 역전될 수 있다.**
예를 들어, 네트워크 운영자가 각 진입 지점에서 네트워크로 들어와 각 출구 지점으로 향하는 트래픽 흐름에 대한 추정치를 가지고 있다면, 운영자는 네트워크의 모든 링크에 걸쳐 최대 사용률을 최소화하는 특정 라우팅 경로를 설정하고자 할 수 있다. 하지만 OSPF와 같은 라우팅 알고리즘에서, 네트워크를 통한 흐름의 라우팅을 조정하기 위한 주요 '조절 장치'는 링크 가중치이다. 따라서 최대 링크 사용률을 최소화하는 목표를 달성하기 위해 운영자는 이 목표를 달성하는 링크 가중치 집합을 찾아야 한다. 이는 인과 관계의 역전이다. 즉, 원하는 트래픽 흐름의 라우팅이 알려져 있고, OSPF 라우팅 알고리즘이 이 원하는 라우팅을 결과로 내도록 OSPF 링크 가중치를 찾아야 한다.