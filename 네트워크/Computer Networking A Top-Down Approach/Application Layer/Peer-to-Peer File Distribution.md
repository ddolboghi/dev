# Scalability of P2P Architectures

클라이언트-서버 아키텍처와 P2P 아키텍처를 비교하고 P2P의 고유한 자체 확장성을 설명하기 위해, 고정된 수의 피어에게 파일을 배포하는 두 아키텍처 유형에 대한 간단한 정량적 모델을 고려한다. 
![[p2p_example.png | 500]]
위와 같이 서버와 피어들은 접속 링크를 통해 인터넷에 연결되어 있다. 인터넷 코어는 충분한 대역폭을 가지고 있어 모든 병목 현상은 접속 네트워크에서 발생한다고 가정한다.
- 서버의 업로드 속도: $u_s$
- i번째 피어의 업로드 속도: $u_i$
- i번째 피어의 다운로드 속도를 $d_i$
- 배포할 파일의 크기: $F$ 비트
- 파일 복사본을 얻으려는 피어의 수: $N$
- 배포 시간: $N$개의 모든 피어에게 파일 복사본을 전달하는 데 걸리는 시간

## Client-Server Architecture
- 서버는 $N$개의 각 피어에게 파일의 복사본 하나씩을 전송해야 하므로 파일 배포 시간은 최소 $NF/u_s$다.
- 가장 낮은 다운로드 속도를 가진 피어($d_{min}$)는 $F$ 비트의 파일을 $F/d_{min}$초보다 짧은 시간에 받을 수 없다. 따라서 최소 배포 시간은 최소 $F/d_{min}$이다.

이 두 가지 관찰을 종합하면, 클라이언트-서버 아키텍처의 최소 배포 시간 `D_cs`는 다음과 같이 나타낼 수 있다:
$D_{cs} = max(\frac{NF}{u_s}, \frac{F}{d_{min}})$

$N$이 충분히 크면, 배포 시간은 `NF/us`에 의해 결정되므로 피어의 수 `N`에 따라 선형적으로 증가한다.
# P2P Architecture
P2P 아키텍처에서는 각 피어가 서버를 도와 파일을 배포할 수 있다.
- 배포 초기에는 서버만이 파일을 가지고 있으므로, 모든 피어 커뮤니티에 파일을 전달하기 위해 서버는 파일의 각 비트를 최소 한 번은 자신의 접속 링크로 보내야 한다. 따라서 최소 배포 시간은 최소 $F/u_s$이다.
- 클라이언트-서버 아키텍처와 마찬가지로, 가장 낮은 다운로드 속도를 가진 피어는 $F/d_{min}$초보다 짧은 시간에 파일을 받을 수 없다. 따라서 최소 배포 시간은 최소 $F/d_{min}$이다.
- 시스템 전체의 총 업로드 용량은 서버의 업로드 속도와 모든 피어의 업로드 속도의 합인 $u_{total} = u_s + u_1 + ... + u_N$이다. 시스템은 $N$개의 각 피어에게 $F$ 비트를 전달해야 하므로 총 $NF$ 비트를 전달해야 한다. 이는 $u_{total}$보다 빠른 속도로 이루어질 수 없으므로, 최소 배포 시간은 최소 $NF/(u_s + u_1 + ... + u_N)$이다.

이 세 가지 관찰을 종합하여 P2P의 최소 배포 시간 $D_{P2P}$는 다음과 같다:

$D_{P2P} = max(F/u_s, F/d_{min}, NF/(u_s + \sum_{} u_i))$

![[distribution_time_graph.png  | 500]]
클라이언트-서버의 배포 시간은 피어 수가 증가함에 따라 선형적으로 무한히 증가하지만, P2P의 배포 시간은 항상 클라이언트-서버보다 짧고, 어떤 피어 수 $N$에 대해서도 1시간 미만으로 유지된다. 이는 P2P 애플리케이션이 비트의 소비자이자 재배포자 역할을 하는 피어 덕분에 **자체 확장성(self-scaling)** 을 가질 수 있음을 보여준다.

# BitTorrent
비트토렌트(BitTorrent)는 대용량 파일을 효율적으로 배포하기 위한 인기 있는 **P2P(Peer-to-Peer) 프로토콜**이다. 클라이언트-서버 방식과 달리 중앙 서버에 대한 의존도를 최소화하고, 사용자들이 서로 직접 파일을 주고받는 방식으로 작동한다.
### 주요 구성 요소
- **토렌트(Torrent)**: 특정 파일을 배포하는 데 참여하는 모든 사용자(피어)의 집합을 의미한다.
- **청크(Chunks)**: 파일은 보통 256KB 크기의 작은 조각들로 나뉘어 전송된다. 피어들은 이 청크 단위로 파일을 다운로드하고 다른 피어에게 업로드한다.
- **트래커(Tracker)**: 토렌트에 참여 중인 피어들의 목록을 추적하고 관리하는 중앙 인프라 노드다. 새로운 피어가 토렌트에 참여하면 트래커는 다른 피어들의 IP 주소 목록을 제공하여 연결을 돕는다.---
### 작동 방식 및 핵심 전략
비트토렌트의 효율성은 두 가지 핵심 전략에 기반한다.
#### 1. 가장 희귀한 조각 먼저 받기 (Rarest First)
피어는 파일을 다운로드할 때, 이웃 피어들 사이에서 가장 적게 복제된, 즉 가장 희귀한 청크를 먼저 요청한다. 이 방식은 희귀한 청크가 네트워크에 빠르게 퍼지도록 하여 모든 피어가 파일의 모든 부분을 원활하게 다운로드할 수 있도록 돕는다.
#### 2. 기브 앤 테이크 전략 (Tit-for-Tat)
피어는 데이터를 업로드할 때 자신에게 가장 높은 속도로 데이터를 보내주는 이웃에게 우선순위를 부여한다. 이를 **팃포탯(tit-for-tat)** 전략이라고 한다.
- **언초크(Unchoked)**: 각 피어는 자신에게 가장 빠르게 데이터를 보내주는 상위 4명의 피어를 선택하여 데이터를 보내준다. 이 상태를 '언초크'라고 한다.
- **낙관적 언초킹(Optimistically Unchoked)**: 30초마다 무작위로 다른 이웃 한 명을 추가로 선택해 청크를 보내준다. 이는 새로 참여한 피어가 첫 청크를 얻어 교환을 시작할 기회를 주고, 더 나은 업로드 파트너를 찾도록 돕는다.
이러한 인센티브 구조는 사용자들이 다운로드만 하는 **'프리라이딩(free-riding)'을 방지**하고 모든 참여자의 활발한 공유를 유도하여 전체 시스템의 효율성을 높이는 핵심적인 역할을 한다.