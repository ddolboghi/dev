# Layered Architecture
- 컴퓨터 네트워크는 계층으로 나눠지며 각 계층은 그 아래 계층과 결합하여 어떤 기능, 즉 서비스를 구현한다.
- 다양한 계층의 프로토콜들을 **프로토콜 스택**이라고 한다.
- 인터넷 프로토콜 스택은 5개의 계층으로 구성된다: Physical, Link, Network, Transport, Application
## Application Layer
- 애플리케이션에 의해 생성된 메시지를 교환하기 위한 네트워크 애플리케이션과 해당 애플리케이션 프로토콜이 있는 곳이다.
- HTTP, SMTP, FTP 등이 있다.
- 이 계층의 패킷을 **메시지(message)** 라고 한다.
## Transport Layer
- 애플리케이션 계층 메시지를 애플리케이션 엔드포인트 간에 전송하는 서비스를 제공한다.
- 인터넷에는 TCP와 UDP라는 두 가지 주요 전송 계층 프로토콜이 있다.
- TCP (Transmission Control Protocol): 연결 지향 서비스, 신뢰할 수 있는 데이터 전송, 흐름 제어, 혼잡 제어를 제공한다. 긴 메시지를 세그먼트로 나눈다.
- UDP (User Datagram Protocol): 연결 없는 서비스를 제공하며, 신뢰성, 흐름 제어, 혼잡 제어를 제공하 않는 no-frills 서비스다.
## Network Layer
- **데이터그램**이라는 네트워크 계층 패킷을 한 호스트에서 다른 호스트로 이동시킨다.
- 네트워크 계층의 프로토콜은 IP (Internet Protocol)다.
- 라우터는 네트워크 계층 프로토콜을 사용하여 경로를 결정한다.
## Link Layer
- 네트워크 계층 **데이터그램을 한 노드에서 다음 인접 노드로 이동**시킨다.
- 링크마다 다른 링크 계층 프로토콜을 사용할 수 있다.
- 링크 계층 패킷을 **프레임**이라고 한다.
## Physical Layer
- **프레임 내의 개별 비트를 한 노드에서 다음 노드로 이동**시킨다.
- 물리 계층의 프로토콜은 링크에 따라 다르며 실제 전송 매체(꼬임쌍 구리선, 광섬유 등)에 따라 달라진다.
# 캡슐화(Encapsulation)
- 캡슐화는 데이터가 계층 간 이동할때 헤더 등의 정보를 추가하여 현재 계층의 데이터 형태로 만드는 것이다.
![[concept_of_encapsulation.png]]
## 패킷 스위치의 계층 구현
- 라우터와 링크 계층 스위치 모두 패킷 스위치다.
- 이러한 장치들은 엔드 시스템과 유사하게 네트워킹 하드웨어와 소프트웨어를 계층으로 구성한다.
- 라우터와 링크 계층 스위치는 프로토콜 스택의 모든 계층을 구현하지 않고, 일반적으로 하위 계층만 구현한다.
- **링크 계층 스위치는 1계층과 2계층을 구현**한다.
	- 링크 계층 스위치는 IP 주소를 인식하지 못하지만, 이더넷 주소와 같은 2계층 주소는 인식할 수 있다.
- **라우터는 1계층부터 3계층까지 구현**한다.
	- 인터넷 라우터는 IP 프로토콜을 구현할 수 있다.
- **호스트는 모든 다섯 계층을 구현**한다. 이는 인터넷 아키텍처가 대부분의 복잡성을 네트워크의 가장자리에 두는 관점과 일치한다.
## 데이터 캡슐화 과정
1. 애플리케이션 계층에서 생성된 **메시지**가 전송 계층으로 전달된다.
2. 전송 계층은 메시지에 **전송 계층 헤더**를 추가하여 **세그먼트**를 형성한다.
3. 세그먼트는 네트워크 계층으로 전달된다.
4. 네트워크 계층은 세그먼트에 **네트워크 계층 헤더**를 추가하여 **데이터그램**을 형성한다.
5. 데이터그램은 링크 계층으로 전달된다.
6. 링크 계층은 데이터그램에 **링크 계층 헤더**와 **링크 계층 트레일러**를 추가하여 프레임을 형성한다.
7. 프레임은 물리 게층으로 전달되어 **비트 단위로 전송**된다.
8. 각 라우터와 링크 계층 스위치에서는 해당 장치가 인식하는 최상위 계층까지 **역캡슐화**가 이루어진 후, 다음 링크로 전달하기 위해 다시 캡슐화한다.
9. 수신 엔드 시스템에서는 이 과정이 역순으로 이루어져 원래 메시지가 애플리케이션 계층으로 전달된다.