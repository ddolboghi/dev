트랜스포트 계층의 다중화와 역다중화는 네트워크 계층이 제공하는 전달 서비스를 호스트에서 실행되는 애플리케이션을 위한 프로세스 간 전달 서비스로 확장하는 것이다.

수신 호스트의 트랜스포트 계층은 하위 계층으로부터 세그먼트를 받아서 이 세그먼트의 데이터를 프로세스의 소켓으로 전달한다. (소켓은 프로세스 당 하나 이상있으며, 각 소켓은 고유한 식별자를 가진다.)

- **demultiplexing**: 수신 호스트가 들어오는 트랜스포트 계층 세그먼트를 올바른 소켓으로 보내는 작업
- **multiplexing**: 발신 호스트에서 여러 소켓으로부터 데이터 청크를 모아 헤더 정보를 붙여 세그먼트를 만들고, 이를 네트워크 계층으로 전달하는 작업

### Port 번호
- multiplexing & demultiplexing 작업을 위해 트랜스포트 계층 세그먼트는 **출발지 포트 번호 필드**(source port-number field)와 **목적지 포트 번호 필드**(destination port-number field)를 가진다.
- 각 포트 번호는 0~65535까지 범위를 갖는 16비트 숫자다.
- 0~1023까지 포트 번호는 well-known 포트 번호라고 불리며, 예약되어 있다. (e.g. HTTP(80), FTP(21))

# UDP Multiplexing & Demultiplexing
- UDP 소켓이 생성될 때, 트랜스포트 계층은 1024~65535 범위 내에서 사용되지 않는 포트 번호를 자동으로 할당한다.
- 또는 `bind()`메서드로 특정 포트 번호를 소켓에 할당할 수도 있다.
- 일반적으로 클라이언트 측은 포트 번호를 자동으로 할당받고, 서버 측은 특정 포트 번호를 할당한다.
- UDP 소켓은 **(목적지 IP 주소, 목적지 포트 번호)** 라는 2-튜플로 식별된다.
- 출발지 IP 주소나 포트 번호가 달라도 목적지 IP 주소와 포트 번호가 같은 UDP 세그먼트들은 모두 동일한 목적지 소켓으로 향한다.
- 출발지 포트 번호는 반환 주소의 일부로 사용된다.
# TCP Multiplexing & Demultiplexing
- TCP 소켓은 **(출발지 IP 주소, 출발지 포트 번호, 목적지 IP 주소, 목적지 포트 번호)** 라는 4-튜플로 식별된다.
- TCP 세그먼트가 호스트에 도착하면, 호스트는 이 네 가지 값을 모두 사용하여 세그먼트를 적절한 소켓으로 역다중화한다.
- 최초 연결 설정 요청을 제외하고, 출발지 IP 주소나 포트 번호가 다른 TCP 세그먼트들은 서로 다른 소켓으로 전달된다.
- TCP 서버 애플리케이션은 웰컴 소켓을 가지고 클라이언트의 연결 요청을 기다린다.
- 클라이언트가 연결을 요청하면 서버 프로세스는 해당 클라이언트 전용의 새로운 연결 소켓을 생성한다.
- 새로운 연결 소켓은 4-튜플로 구별되며, 이후 도착하는 모든 세그먼트 중 이 네 가지 값이 일치하는 것들은 이 소켓으로 역다중화된다.
![[tcp_multiplexing_and_demultiplexing_example.png | 600]]