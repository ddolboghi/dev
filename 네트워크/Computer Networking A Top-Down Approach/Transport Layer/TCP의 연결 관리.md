TCP 연결 설정 과정은 웹 서핑 시 인지되는 지연에 상당한 영향을 줄 수 있다.
SYN 플러드 공격과 같은 많은 네트워크 공격이 TCP 연결 관리의 취약점을 이용한다.
# TCP 연결 설정: 3-way handshake
클라이언트의 TCP는 서버의 TCP와 연결을 설정하기 위해 다음 3단계 과정을 거친다.
이 세 단계가 완료되면 클라이언트와 서버 호스트는 데이터를 포함한 세그먼트를 서로 전송할 수 있다.
이 연결 과정은 **두 호스트 간에 패킷 3개가 전송**되기 때문에 3-way handshake라고 불린다.
![[TCP_3-way_handshake.png | 500]]
1. 클라이언트 측 TCP는 서버 측 TCP에게 **SYN 세그먼트**를 보낸다.
	- 이 세그먼트에는 애플리케이션 데이터가 없다.
	- 헤더의 플래그 비트 중 **SYN 비트가 1**로 설정된다.
	- 클라이언트는 임의의 초기 sequence number(`client_isn`)를 선택하여 sequence number 필드에 넣는다.
2. 서버가 SYN 세그먼트를 수신하면, 연결을 위한 TCP 버퍼와 변수들을 할당하고 클라이언트 TCP에게 **SYNACK 세그먼트(연결 승인 세그먼트)** 를 보낸다.
	- 이 세그먼트에는 애플리케이션 데이터가 없다.
	- 헤더의 SYN 비트가 1로 설정된다.
	- ACK 필드에 `client_isn+1`이 설정된다.
	- 서버는 자신만의 초기 sequence number(`server_isn`)를 선택하여 sequence number 필드에 넣는다.
3. 클라이언트가 SYNACK 세그먼트를 수신하면, 연결을 위한 TCP 버퍼와 변수들을 할당하고 서버에게 또 다른 세그먼트를 보내 서버의 연결 승인을 확인 응답한다.
	- ACK 필드에 `server_isn+1`값을 넣는다.
	- 연결이 설정되었으므로, 헤더의 SYN 비트가 0으로 설정된다.
	- 데이터를 페이로드에 실어 보낼 수 있다.
### 생각해볼거리
- 초기 시퀀스 번호가 필요한 이유는 무엇인가요?
- 2-way가 아닌 3-way handshake가 필요한 이유는 무엇인가요?
# TCP 연결 해제
클라이언트와 서버 둘 중 누구라도 연결을 종료할 수 있다. 연결이 종료되면 호스트의 자원(버퍼, 변수 등)이 해제된다.
