# Packet-Switched Networks의 지연
## Processing Delay (dproc)
- 패킷 헤더를 검사하고 패킷을 적절한 출력 링크로 전달하는데 필요한 시간이다.
- 다른 요인도 포함될 수 있다. 예: upstream 노드에서 라우터 A로 패킷 비트를 전송하는 동안 발생한 비트 수준 오류를 확인하는데 필요한 시간
- 고속 라우터의 경우 일반적으로 마이크로초 단위 이하다.
- 라우터의 **최대 처리량**에 큰 영향을 미친다.
## Queuing Delay (dqueue)
- 패킷이 전송을 기다리며 큐(버퍼)에서 보내는 시간이다.
- 링크가 현재 사용 중이거나 이미 다른 패킷들이 큐에 대기 중일 때 발생한다.
- 패킷마다 다를 수 있으며, 통계적 측정치(예: 평균 큐잉 지연, 분산)로 특성화된다.
## Transmission Delay (dtrans)
- 패킷의 모든 비트를 링크로 전송하는데 필요한 시간이다.
- 패킷 길이(L)를 링크의 전송 속도(R, bit/sec)로 나누어 계산한다.($\frac{L}{R}$)
	- 예를 들어, 1 Gbps 링크에서 1000 byte(8000 bit) 패킷을 전송하는데 8 ms가 걸린다.
- 네트워크 환경에 따라 무시할 수 있는 수준(LAN의 10 Mbps 이상)부터 수백 ms(저속 다이얼업 모뎀 링크를 통한 대형 인터넷 패킷)까지 다양하다.
## Propagation Delay (dprop)
- 비트가 링크의 시작 지점에서 목적지까지 이동하는데 걸리는 시간이다.
- 링크의 길이(=인접 라우터 사이의 거리)(d)를 전파 속도(s)로 나누어 계산한다.($\frac{d}{s}$)
- 전파 속도는 빛의 속도에 가깝다.
- 때때로 무시할 수 있지만, 단거리 링크의 경우 dnodal에서 지배적인 항이 될 수 있다.
## Transmission Delay와 propagation Delay 비교
라우터 = 톨게이트, 링크 = 고속도로 구간, 비트 = 자동차, 패킷 = 자동차 행렬이라고 한다면,
톨게이트에서 전체 행렬을 고속도로에 진입시키는 시간은 전송 지연이고,
톨게이트 간 이동 시간은 전파 지연이다.

> [!tip]
    > 총 노드 지연: dnodal = dproc + dqueue + dtrans + dprop

> [!NOTE]
    > 종단 시스템 지연, 애플리케이션 지연, 미디어 패킷화 지연 등이 발생할 수 있으며, VoIP 애플리케이션에서 패킷화 지연은 사용자 인지 품질에 영향을 미칠 수 있다.

# Queuing Delay과 패킷 손실

## 큐잉 지연의 가변성
- 큐잉 지연은 다른 세가지 지연(dproc, dtrans dprop)과 달리 패킷마다 달라질 수 있다.
- 예를 들어, 10개의 패킷이 빈 큐에 동시에 도착하면 첫 번째 패킷은 큐잉 지연이 없지만, 마지막 패킷은 다른 9개의 패킷이 전송될 때까지 기다려야 하므로 상대적으로 큰 큐잉 지연을 겪는다.
- 따라서 큐잉 지연을 특성화할때는 **평균 큐잉 지연, 큐잉 지연의 분산, 특정 값을 초과하는 큐잉 지연의 확률 같은 통계적 측정치를 사용**한다.
## 트래픽 강도(I)
- 큐잉 지연의 정도를 직관적으로 이해하는데 유용한 개념으로, $I = \frac{La}{R}$로 정의된다. 이는 비트가 큐에 도착하는 평균 속도를 비트를 전송할 수 있는 속도로 나눈 값이다.
	- $L$: 평균 패킷 길이
	- $a$: 평균 패킷 도착률
	- $R$: 비트 전송 속도
![[average_queuing_delay_graph.png]]
- 트래픽 강도가 0에 가까우면 패킷 도착이 드물고, 도착하는 패킷이 큐에서 다른 패킷을 발견할 가능성이 낮아 평균 큐잉 지연은 0에 가깝다.
- 트래픽 강도가 1에 가까워지면 패킷 도착률의 변동성으로 인해 도착률이 전송 용량을 초과하는 시간 간격이 발생하고, 이 기간 동안 큐가 형성된다.
- 도착률이 전송 용량보다 낮아지면 큐 길이가 줄어들지만, 트래픽 강도가 1에 가까워질수록 평균 큐 길이는 계속해서 길어진다.
## 패킷 손실
- 큐잉 버퍼 공간이 유한하기 때문에 패킷 손실이 발생한다.
- 도착하는 패킷이 버퍼가 다른 패킷들로 완전히 가득 찬 것을 발견하면, 도착하는 패킷이나 이미 큐에 있는 패킷 중 하나가 삭제될 수 있다.
- 호스트 A와 B가 호스트 E로 패킷을 전송하는 시나리오에서, 라우터에 대한 패킷 도착률이 링크의 전송 속도를 초과하면 **혼잡**이 발생하여 패킷이 링크의 출력 버퍼에 큐잉된다.

# 종단 간 지연
- 종단 간 지연은 패킷이 소스에서 목적지까지 이동하는 전체 경로에서 발생하는 총 지연을 의미한다.
- 출발지 호스트와 목적지 호스트 사이에 N개의 라우터들이 있고, 네트워크가 혼잡하지 않아 큐잉 지연을 무시할 수 있을때 패킷의 총 종단 간 지연 시간은 다음과 같다:
  $d_{end-end} = N(d_{proc} + d_{trans} + d_{prop})$
- 종단 시스템이 공유 매체(wifi, 케이블 모뎀)로 패킷을 전송하려고 할때, 다른 종단 시스템과 매체를 공유하기 위한 프로토콜의 일부로서 의도적으로 전송을 지연시킬 수 있다.
# 컴퓨터 네트워크의 처리량
- 처리량은 출발지에서 목적지까지 데이터를 전송하는 속도다.
- 순간 처리량과 평균 처리량을 측정할 수 있다.
## 병목 링크
- 출발지와 목적지 사이의 경로에서 여러 링크가 있을때, 가장 낮은 전송 속도를 가진 링크가 병목 링크가 되어 전체 처리량을 제한한다. 
- 링크 속도를 R이라고 했을때, 출발지와 목적지 간 처리량은 $min({R_1, R_2, ..., R_N})$이다.
- 현대 인터넷의 핵심 네트워크는 일반적으로 고속 링크이므로 혼잡이 거의 발생하지 않는다. 따라서 **처리량의 제한 요인은 주로 액세스 네트워크**다.
- 처리량은 경로상의 링크 전송 속도뿐만 아니라 다른 트래픽의 간섭에도 영향을 받는다.
	- 10개의 서버(Rs)와 10개의 클라이언트(Rc)가 네트워크 코어에 연결되어 있고, 모든 10개의 다운로드가 하나의 공통 링크 R을 통과하는 경우, 공유 링크의 속도 R이 Rs나 Rc와 비슷하다면, 각 다운로드의 처리량은 이 공유 링크에 의해 제한된다. 예를 들어, Rs = 2 Mbps, Rc = 1 Mbps, R = 5 Mbps인 경우, 공통 링크가 10개 다운로드에 균등하게 대역폭을 분할하면 각 다운로드는 500 kbps의 처리량만 얻게 된다.