- 네트워크 코어는 인터넷의 최종 시스템을 상호 연결하는 패킷 스위치와 링크의 메쉬다.
- 링크와 스위치 네트워크를 통해 데이터를 이동시킬때 **circuit switching**과 **packet switching**이라는 두 가지 기본 접근 방식이 있다.
## Packet switching
- 각 패킷은 통신 링크와 패킷 스위치를 통해 이동한다.
- 패킷 스위치에는 **라우터**와 **링크 레이어 스위치**의 두 가지 주요 유형이 있다.
- 패킷은 각 통신 링크를 통해 링크의 전체 전송 속도와 동일한 속도로 전송된다.
- 패킷 스위치에는 여러 개의 링크가 연결되어 있다.
- source end system 또는 패킷 스위치가 전송 속도 R bit/sec의 링크를 통해 L bit 패킷을 전송하는 경우, 패킷 전송 시간은 L/R sec다.
	${패킷 크기}\div{패킷 스위치 전송 속도}={패킷 전송 시간}$
- packet switching은 링크를 통해 다른 패킷을 동시에 전송해야 하기 때문에 링크 중 하나가 혼잡한 경우 패킷은 버퍼에서 대기해야 하며 지연이 발생한다.
### Store-and-Forward Transmission
- 대부분의 패킷 스위치는 저장-후-전달 전송 방식을 사용한다.
- 패킷 스위치(라우터)는 **한 패킷의 모든 비트를 수신한 후에만 출력 링크로 그 패킷을 전송**하기 시작한다. 즉, 라우터는 패킷의 모든 비트를 **수신**, **저장**, **처리**한 뒤에 출력 링크로 전송할 수 있다.
	![[packet_switching1.png]]
	
- 링크는 end system과 패킷 스위치, 패킷 스위치와 패킷 스위치사이의 경로다.
- n개의 링크가 있으면 n-1개의 라우터가 있다.
- end system 또는 패킷 스위치가 R bit/sec 의 속도로 링크에서 L비트의 패킷을 보낸다면, 그 패킷을 전송하는데 걸리는 시간은 $\frac{L}{R}$ 초다.
- 전파 지연이 없고, 출발지와 목적지 사이에 n개의 링크가 있을때 패킷 1개의 전송 시간은 $n\frac{L}{R}$이다.
### 대기열 지연과 패킷 손실 (at store-and-forward transmission)
- 패킷 스위치는 연결된 링크마다 output buffer(output queue)를 가진다.
- output buffer에 해당 링크로 보내려는 패킷을 저장한다.
- 다른 패킷을 전송하는데 링크가 사용되고 있다면 패킷은 output buffer에서 대기한다. 그래서 패킷은 store-and-forward 지연뿐만 아니라, **output buffer에서 queuing 지연**도 겪는다.
- queuing 지연은 가변적이고 네트워크 혼잡도에 영향을 받는다.
- **buffer 공간이 가득 차면** 해당 buffer에 도착한 패킷 또는 대기 중인 패킷 중 하나가 삭제되어 **패킷 손실**이 발생한다.
- 라우터에 도착하는 패킷의 전송률이 라우터의 송신률보다 크면 output buffer에서 queuing 지연이 발생한다.
### Forwarding Tables and Routing Protocols
- 라우터가 패킷이 가야할 링크를 정해주는 것을 패킷 포워딩이라고 한다.
- 각 라우터에는 목적지 주소(또는 일부)를 해당 라우터의 출력 링크로 매핑하는 forwarding table이 있다.
- 인터넷의 여러 **routing protocol로 forwarding table을 자동으로 설정**한다.
	- 예를 들어, routing protocol은 라우터에서 목적지까지 최단 경로를 결정하고 이 결과를 forwarding table을 구성하는데 사용한다.
- 패킷이 라우터를 통해 목적지에 도달하는 과정은 지도 없이 사람들에게 물어가면서 목적지에 도착하려는 운전자와 유사하다.
	- 운전자 == 패킷
	- 래우터 == 묻는 사람
	- 사람들은 전체 경로의 일부 중 당장 가야할 가까운 경로를 알려준다.
1. 출발지 end system이 목적지 end system으로 패킷을 보낼때  목적지의 IP 주소를 패킷 헤더에 포함시킨다.
2. 라우터는 패킷의 목적지 주소를 검사한다.
3. 라우터는 forwarding table에서 목적지 주소에 인접한 라우터로 가는 출력 링크를 찾는다.
4. 라우터는 패킷을 출력 링크로 라우팅한다.

## Circuit switching
- 회선 교환 네트워크에서는 엔드 시스템 간 통신 세션의 지속 시간 동안 경로를 따라 필요한 **자원**(버퍼, 링크 전송 속도)이 **예약**된다.
- 회선 교환 네트워크는 통신을 시작하기 전에 필요한 모든 자원이 할당된다.
- 두 호스트 간 데이터가 전송되기 전에 먼저 전용 종단 간 연결을 설정해야하고, 이러한 연결을 회로(circuit)라고 한다.
- 전송 속도가 예약되있기 때문에 보장된 **일정 속도로 데이터를 보낼 수 있다.**
- 링크가 N개면, 하나의 링크는 연결 지속 시간 동안 링크 총 전송 용량의 ${\frac{1}{N}}$을 예약한다.
![[Pasted image 20240815001131.png | 300]]
- 각 링크는 회로를 4개씩 가지고 있다.
- 각 회로는 4개의 동시 연결을 지원할 수 있다.
- 두 호스트가 연결되길 원할때 네트워크는 전용 end-to-end 연결을 설정한다.
- 각 링크에는 4개의 회로가 있으므로 링크 전송 용량의 ${\frac{1}{4}}$이 개별 end-to-end 연결에 사용된다.
	- 예를 들어 인접 스위치 간의 각 링크의 전송 속도가 1Mbps인 경우, 각 종단 간 회선 교환 연결의 전송 속도는 250kbps이다.
- circuit switching은 전용 회로가 유휴 시간 동안 유휴 상태이기 때문에 낭비가 발생한다.
- 회로를 설정하고 전송 용량을 예약하는 것이 복잡하고 경로를 따라 스위치의 작동을 조정하는 복잡한 시그널링 소프트웨어가 필요하다.
### Packet switching과의 차이점
- 회선 교환과 달리 인터넷과 같은 패킷 교환 네트워크에서는 어떤 링크 자원도 예약하지 않고 패킷이 네트워크로 전송된다.
- 만약 다른 패킷들도 동시에 해당 링크로 전송되어 링크가 혼잡하면, 패킷은 전송 링크의 송신 측 버퍼에서 기다려야 해서 지연이 발생한다.
- **인터넷은 패킷을 전달, 순서있는 전달, 데이터 무결성을 보장하지 않는다.** 이러한 이유로 IP는 신뢰할 수 없는 서비스라고 불린다.
### 회선 교환 네트워크의 다중화 방식
![[FDM and TDM.png | 500]]
- 회선 교환 네트워크에서 링크의 다중화는 주파수 분할 다중화(FDM; frequency-division multiplexing) 또는 시분할 다중화(TDM; time-division multiplexing)로 구현된다.
#### FDM
- 링크의 대역폭을 여러 주파수 대역으로 분할한다.
> [!tip]
> 주파수 대역의 폭을 대역폭(bandwidth)이라고 한다.
- 각 주파수 대역은 특정 연결에 대해 고정적으로 예약된다.
- 각 연결은 세션 지속 시간 동안 자신의 주파수 대역을 사용하여 전송한다.
#### TDM
- 고정된 기간의 프레임으로 시간을 나누고, 각 프레임은 고정된 수의 시간 슬롯으로 나뉜다.
- 네트워크가 링크를 통해 연결을 설정하면 네트워크는 매 프레임마다 하나의 시간 슬롯을 이 연결에 할당한다. 
- 이 슬롯은 해당 연결 전용으로 사용되며, 연결 데이터를 전송하는 데 사용할 수 있는 시간 슬롯이 매 프레임마다 하나씩 있다.
- 각 회로는 시간 슬롯 기간 동안 링크의 전체 대역폭을 주기적으로 사용한다.
- TDM에서 회로의 전송 속도 = 프레임 속도 X 슬롯의 비트 수
	- 프레임 전송 속도가 8000 frame/sec이고 각각의 슬롯이 8bit라면 전송 속도는 64kbps이다.
- ex) 24개의 슬롯을 가진 전송 속도 1.536 Mbps TDM 링크를 통해 호스트 A에서 호스트 B로 640,000 bits의 파일을 circuit switching으로 전송할때:
	- 전파 지연을 무시하면 전송 시간은 링크 개수와 상관없다.
	- 회로를 설정하는데 500 msec 소요
	- 각 회로의 전송 속도는 (1.536 Mbps) / 24 = 64 kbps
	- 파일 전송 속도는 (640,000 bits) / (64 kbps) + 500ms = 10.5sec

## Packet switching vs Circuit switching
사용자가 10명인데 한 사용자가 갑자기 1,000 bits 패킷 1,000개를 생성하고 다른 사용자는 대기 상태로 패킷을 생성하지 않는다고 가정해 보자. 
circuit switching은 프레임당 10개의 슬롯이 있고 각 슬롯이 1,000비트로 구성된 TDM을 사용한다.
활성 사용자는 프레임당 하나의 시간 슬롯만 사용하여 데이터를 전송할 수 있고 각 프레임의 나머지 9개 시간 슬롯은 유휴 상태로 유지된다. 
활성 사용자의 100만 bits 데이터가 모두 전송되기까지는 10초가 걸린다. 
packet switching의 경우 활성 사용자의 패킷과 다중화해야 하는 패킷을 생성하는 다른 사용자가 없기 때문에 활성 사용자는 전체 링크 속도인 1Mbps로 패킷을 계속 보낼 수 있다. 
이 경우 활성 사용자의 모든 데이터는 1초 이내에 전송된다.
즉, **circuit switching은 연결을 사용하지 않아도 자원이 유휴 상태로 남아있어 packet switching에 비해 효율성이 떨어진다.**