---
chapter: "1"
---





# ## Packet-Switched Networks의 지연, 손실, 처리량
## Packet-Switched Networks의 지연
### Processing Delay (dproc)
- 패킷 헤더를 검사하고 패킷을 적절한 출력 링크로 전달하는데 필요한 시간이다.
- 다른 요인도 포함될 수 있다. 예: upstream 노드에서 라우터 A로 패킷 비트를 전송하는 동안 발생한 비트 수준 오류를 확인하는데 필요한 시간
- 고속 라우터의 경우 일반적으로 마이크로초 단위 이하다.
- 라우터의 **최대 처리량**에 큰 영향을 미친다.
### Queuing Delay (dqueue)
- 패킷이 전송을 기다리며 큐(버퍼)에서 보내는 시간이다.
- 링크가 현재 사용 중이거나 이미 다른 패킷들이 큐에 대기 중일 때 발생한다.
- 패킷마다 다를 수 있으며, 통계적 측정치(예: 평균 큐잉 지연, 분산)로 특성화된다.
### Transmission Delay (dtrans)
- 패킷의 모든 비트를 링크로 전송하는데 필요한 시간이다.
- 패킷 길이(L)를 링크의 전송 속도(R, bit/sec)로 나누어 계산한다.($\frac{L}{R}$)
	- 예를 들어, 1 Gbps 링크에서 1000 byte(8000 bit) 패킷을 전송하는데 8 ms가 걸린다.
- 네트워크 환경에 따라 무시할 수 있는 수준(LAN의 10 Mbps 이상)부터 수백 ms(저속 다이얼업 모뎀 링크를 통한 대형 인터넷 패킷)까지 다양하다.
### Propagation Delay (dprop)
- 비트가 링크의 시작 지점에서 목적지까지 이동하는데 걸리는 시간이다.
- 링크의 길이(=인접 라우터 사이의 거리)(d)를 전파 속도(s)로 나누어 계산한다.($\frac{d}{s}$)
- 전파 속도는 빛의 속도에 가깝다.
- 때때로 무시할 수 있지만, 단거리 링크의 경우 dnodal에서 지배적인 항이 될 수 있다.
### Transmission Delay와 propagation Delay 비교
라우터 = 톨게이트, 링크 = 고속도로 구간, 비트 = 자동차, 패킷 = 자동차 행렬이라고 한다면,
톨게이트에서 전체 행렬을 고속도로에 진입시키는 시간은 전송 지연이고,
톨게이트 간 이동 시간은 전파 지연이다.

> [!tip]
    > 총 노드 지연: dnodal = dproc + dqueue + dtrans + dprop

> [!NOTE]
    > 종단 시스템 지연, 애플리케이션 지연, 미디어 패킷화 지연 등이 발생할 수 있으며, VoIP 애플리케이션에서 패킷화 지연은 사용자 인지 품질에 영향을 미칠 수 있다.

## Queuing Delay과 패킷 손실

### 큐잉 지연의 가변성
- 큐잉 지연은 다른 세가지 지연(dproc, dtrans dprop)과 달리 패킷마다 달라질 수 있다.
- 예를 들어, 10개의 패킷이 빈 큐에 동시에 도착하면 첫 번째 패킷은 큐잉 지연이 없지만, 마지막 패킷은 다른 9개의 패킷이 전송될 때까지 기다려야 하므로 상대적으로 큰 큐잉 지연을 겪는다.
- 따라서 큐잉 지연을 특성화할때는 **평균 큐잉 지연, 큐잉 지연의 분산, 특정 값을 초과하는 큐잉 지연의 확률 같은 통계적 측정치를 사용**한다.
### 트래픽 강도(I)
- 큐잉 지연의 정도를 직관적으로 이해하는데 유용한 개념으로, $I = \frac{La}{R}$로 정의된다. 이는 비트가 큐에 도착하는 평균 속도를 비트를 전송할 수 있는 속도로 나눈 값이다.
	- $L$: 평균 패킷 길이
	- $a$: 평균 패킷 도착률
	- $R$: 비트 전송 속도
![[average_queuing_delay_graph.png]]
- 트래픽 강도가 0에 가까우면 패킷 도착이 드물고, 도착하는 패킷이 큐에서 다른 패킷을 발견할 가능성이 낮아 평균 큐잉 지연은 0에 가깝다.
- 트래픽 강도가 1에 가까워지면 패킷 도착률의 변동성으로 인해 도착률이 전송 용량을 초과하는 시간 간격이 발생하고, 이 기간 동안 큐가 형성된다.
- 도착률이 전송 용량보다 낮아지면 큐 길이가 줄어들지만, 트래픽 강도가 1에 가까워질수록 평균 큐 길이는 계속해서 길어진다.
### 패킷 손실
- 큐잉 버퍼 공간이 유한하기 때문에 패킷 손실이 발생한다.
- 도착하는 패킷이 버퍼가 다른 패킷들로 완전히 가득 찬 것을 발견하면, 도착하는 패킷이나 이미 큐에 있는 패킷 중 하나가 삭제될 수 있다.
- 호스트 A와 B가 호스트 E로 패킷을 전송하는 시나리오에서, 라우터에 대한 패킷 도착률이 링크의 전송 속도를 초과하면 **혼잡**이 발생하여 패킷이 링크의 출력 버퍼에 큐잉된다.

## 종단 간 지연
- 종단 간 지연은 패킷이 소스에서 목적지까지 이동하는 전체 경로에서 발생하는 총 지연을 의미한다.
- 출발지 호스트와 목적지 호스트 사이에 N개의 라우터들이 있고, 네트워크가 혼잡하지 않아 큐잉 지연을 무시할 수 있을때 패킷의 총 종단 간 지연 시간은 다음과 같다:
  $d_{end-end} = N(d_{proc} + d_{trans} + d_{prop})$
- 종단 시스템이 공유 매체(wifi, 케이블 모뎀)로 패킷을 전송하려고 할때, 다른 종단 시스템과 매체를 공유하기 위한 프로토콜의 일부로서 의도적으로 전송을 지연시킬 수 있다.
## 컴퓨터 네트워크의 처리량
- 처리량은 출발지에서 목적지까지 데이터를 전송하는 속도다.
- 순간 처리량과 평균 처리량을 측정할 수 있다.
### 병목 링크
- 출발지와 목적지 사이의 경로에서 여러 링크가 있을때, 가장 낮은 전송 속도를 가진 링크가 병목 링크가 되어 전체 처리량을 제한한다. 
- 링크 속도를 R이라고 했을때, 출발지와 목적지 간 처리량은 $min({R_1, R_2, ..., R_N})$이다.
- 현대 인터넷의 핵심 네트워크는 일반적으로 고속 링크이므로 혼잡이 거의 발생하지 않는다. 따라서 **처리량의 제한 요인은 주로 액세스 네트워크**다.
- 처리량은 경로상의 링크 전송 속도뿐만 아니라 다른 트래픽의 간섭에도 영향을 받는다.
	- 10개의 서버(Rs)와 10개의 클라이언트(Rc)가 네트워크 코어에 연결되어 있고, 모든 10개의 다운로드가 하나의 공통 링크 R을 통과하는 경우, 공유 링크의 속도 R이 Rs나 Rc와 비슷하다면, 각 다운로드의 처리량은 이 공유 링크에 의해 제한된다. 예를 들어, Rs = 2 Mbps, Rc = 1 Mbps, R = 5 Mbps인 경우, 공통 링크가 10개 다운로드에 균등하게 대역폭을 분할하면 각 다운로드는 500 kbps의 처리량만 얻게 된다.

# 프로토콜 계층과 그것의 서비스 모델
## Layered Architecture
- 컴퓨터 네트워크는 계층으로 나눠지며 각 계층은 그 아래 계층과 결합하여 어떤 기능, 즉 서비스를 구현한다.
- 다양한 계층의 프로토콜들을 **프로토콜 스택**이라고 한다.
- 인터넷 프로토콜 스택은 5개의 계층으로 구성된다: Physical, Link, Network, Transport, Application
### Application Layer
- 애플리케이션에 의해 생성된 메시지를 교환하기 위한 네트워크 애플리케이션과 해당 애플리케이션 프로토콜이 있는 곳이다.
- HTTP, SMTP, FTP 등이 있다.
- 이 계층의 패킷을 **메시지(message)** 라고 한다.
### Transport Layer
- 애플리케이션 계층 메시지를 애플리케이션 엔드포인트 간에 전송하는 서비스를 제공한다.
- 인터넷에는 TCP와 UDP라는 두 가지 주요 전송 계층 프로토콜이 있다.
- TCP (Transmission Control Protocol): 연결 지향 서비스, 신뢰할 수 있는 데이터 전송, 흐름 제어, 혼잡 제어를 제공한다. 긴 메시지를 세그먼트로 나눈다.
- UDP (User Datagram Protocol): 연결 없는 서비스를 제공하며, 신뢰성, 흐름 제어, 혼잡 제어를 제공하 않는 no-frills 서비스다.
### Network Layer
- **데이터그램**이라는 네트워크 계층 패킷을 한 호스트에서 다른 호스트로 이동시킨다.
- 네트워크 계층의 프로토콜은 IP (Internet Protocol)다.
- 라우터는 네트워크 계층 프로토콜을 사용하여 경로를 결정한다.
### Link Layer
- 네트워크 계층 **데이터그램을 한 노드에서 다음 인접 노드로 이동**시킨다.
- 링크마다 다른 링크 계층 프로토콜을 사용할 수 있다.
- 링크 계층 패킷을 **프레임**이라고 한다.
### Physical Layer
- **프레임 내의 개별 비트를 한 노드에서 다음 노드로 이동**시킨다.
- 물리 계층의 프로토콜은 링크에 따라 다르며 실제 전송 매체(꼬임쌍 구리선, 광섬유 등)에 따라 달라진다.
## 캡슐화(Encapsulation)
- 캡슐화는 데이터가 계층 간 이동할때 헤더 등의 정보를 추가하여 현재 계층의 데이터 형태로 만드는 것이다.
![[concept_of_encapsulation.png]]
### 패킷 스위치의 계층 구현
- 라우터와 링크 계층 스위치 모두 패킷 스위치다.
- 이러한 장치들은 엔드 시스템과 유사하게 네트워킹 하드웨어와 소프트웨어를 계층으로 구성한다.
- 라우터와 링크 계층 스위치는 프로토콜 스택의 모든 계층을 구현하지 않고, 일반적으로 하위 계층만 구현한다.
- **링크 계층 스위치는 1계층과 2계층을 구현**한다.
	- 링크 계층 스위치는 IP 주소를 인식하지 못하지만, 이더넷 주소와 같은 2계층 주소는 인식할 수 있다.
- **라우터는 1계층부터 3계층까지 구현**한다.
	- 인터넷 라우터는 IP 프로토콜을 구현할 수 있다.
- **호스트는 모든 다섯 계층을 구현**한다. 이는 인터넷 아키텍처가 대부분의 복잡성을 네트워크의 가장자리에 두는 관점과 일치한다.
### 데이터 캡슐화 과정
1. 애플리케이션 계층에서 생성된 **메시지**가 전송 계층으로 전달된다.
2. 전송 계층은 메시지에 **전송 계층 헤더**를 추가하여 **세그먼트**를 형성한다.
3. 세그먼트는 네트워크 계층으로 전달된다.
4. 네트워크 계층은 세그먼트에 **네트워크 계층 헤더**를 추가하여 **데이터그램**을 형성한다.
5. 데이터그램은 링크 계층으로 전달된다.
6. 링크 계층은 데이터그램에 **링크 계층 헤더**와 **링크 계층 트레일러**를 추가하여 프레임을 형성한다.
7. 프레임은 물리 게층으로 전달되어 **비트 단위로 전송**된다.
8. 각 라우터와 링크 계층 스위치에서는 해당 장치가 인식하는 최상위 계층까지 **역캡슐화**가 이루어진 후, 다음 링크로 전달하기 위해 다시 캡슐화한다.
9. 수신 엔드 시스템에서는 이 과정이 역순으로 이루어져 원래 메시지가 애플리케이션 계층으로 전달된다.

# Networks Under Attack
### 악성코드 (Malware)
- 악성코드가 기기를 감염시키면, 파일 삭제, 주민등록번호, 비밀번호, 키 입력과 같은 개인 정보를 수집하는 스파이웨어(spyware) 설치 후 악당들에게 전송, 그리고 **봇넷**이라는 수천 개의 침해된 기기 네트워크에 기기를 편입시켜 스팸 이메일 배포 또는 분산 서비스 거부(DDoS) 공격에 활용될 수 있다.
### 서비스 거부 (Denial-of-Service, DoS) 공격:
- DoS 공격은 합법적인 사용자가 인프라를 사용할 수 없도록 만드려는 시도를 포함한다. 웹 서버, 이메일 서버, DNS 서버, 기관 네트워크 등이 DoS 공격의 대상이 될 수 있다.
- 대부분의 인터넷 DoS 공격은 세 가지 범주 중 하나에 속한다:
	- 취약점 공격 (Vulnerability attack): 표적 호스트에서 실행되는 취약한 애플리케이션 또는 운영 체제로 잘 조작된 메시지 몇 개를 전송하는 것을 포함한다. 조작된 패킷 시퀀스가 전송되면 서비스가 중단되거나, 더 심하면 호스트가 충돌할 수 있다.
	- 대역폭 플러딩 (Bandwidth flooding): 공격자가 표적 호스트에 엄청난 양의 패킷을 전송하여, 대상의 액세스 링크가 막히고 합법적인 패킷이 서버에 도달하는 것을 방해한다.
	- 연결 플러딩 (Connection flooding): 공격자가 표적 호스트에 수많은 half-open 또는 fully open TCP 연결을 설정한다. 이로 인해 호스트가 이러한 가짜 연결로 너무 과부하되어 합법적인 연결을 수락하지 못하게 될 수 있다.
- 분산 DoS (Distributed DoS, DDoS) 공격은 **Figure 1.25**에 설명되어 있으며, 공격자가 여러 소스(zombie)를 제어하여 각 소스가 표적에 트래픽을 집중시키는 방식이다. 이 접근 방식에서는 모든 제어된 소스의 총 트래픽 속도가 서비스 무력화를 위해 표적의 접근 속도 R에 근접해야 한다. 수천 개의 침해된 호스트(봇넷)를 활용하는 DDoS 공격은 오늘날 흔한 일이며, 단일 호스트의 DoS 공격보다 탐지 및 방어하기 훨씬 어렵다.
### 패킷 스니핑 (Packet Sniffing)
- 수동 수신기(passive receiver)를 무선 송신기 근처에 배치하면 전송되는 모든 패킷의 사본을 얻을 수 있다.
- 이러한 패킷에는 비밀번호, 주민등록번호, 영업 비밀, 개인 메시지 등 민감한 정보가 포함될 수 있다. 지나가는 모든 패킷의 사본을 기록하는 수동 수신기를 **패킷 스니퍼(packet sniffer)** 라고 한다.
- 스니퍼는 유선 환경에서도 배치될 수 있다. 많은 이더넷 LAN과 같은 유선 브로드캐스트 환경에서는 패킷 스니퍼가 LAN을 통해 전송되는 브로드캐스트 패킷의 사본을 얻을 수 있다. 케이블 액세스 기술도 패킷을 브로드캐스트하므로 스니핑에 취약하다.
- 또한, 기관의 액세스 라우터 또는 인터넷 액세스 링크에 접근한 악당은 조직으로/에서 오가는 모든 패킷의 사본을 만드는 스니퍼를 설치할 수 있다.
- 패킷 스니핑 소프트웨어는 웹 사이트와 상업 제품(Wireshark)으로 자유롭게 이용 가능하다.
- 패킷 스니퍼는 수동적이므로(채널에 패킷을 주입하지 않음) 탐지하기 어렵다. 따라서 무선 채널로 패킷을 보낼 때, 악당이 패킷 사본을 기록할 가능성이 있다. 패킷 스니핑에 대한 최선의 방어책 중 일부로 **암호화(cryptography)** 가 있다.
### 신뢰하는 사람으로 위장 (Masquerading as Someone You Trust)
- 임의의 소스 주소, 패킷 내용 등으로 패킷을 생성하는 것이 매우 쉽기 때문에 한 사용자가 다른 사용자로 위장할 수 있다.
- 이 문제를 해결하기 위해서는 종단점 인증(end-point authentication), 즉 메시지가 우리가 생각하는 곳에서 실제로 originated했는지 확실하게 판단할 수 있는 메커니즘이 필요하다.