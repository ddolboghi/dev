# 방화벽(firewall)
- 방화벽은 조직의 내부 네트워크를 인터넷과 같은 외부 네트워크로부터 격리하여 패킷을 허용하거나 차단함으로써 트래픽 흐름을 제어하는 하드웨어와 소프트웨어의 조합이다.
- 방화벽은 라우터 안에 구현되며, SDN들을 사용해서 원격 컨트롤이 가능하다.
## 방화벽의 3가지 목표
1. 들어오고 나가는 모든 트래픽은 방화벽을 통과해야 한다.
	- 네트워크의 단일 지점에 방화벽을 위치시키면 보안 접근 정책을 관리하고 시행하기 쉽다.
2. 로컬 보안 정책에 정의된 대로 승인된 트래픽만 방화벽을 통과할 수 있다.
3. 방화벽 자체는 침투로부터 안전해야 한다.
	- 방화벽 자체는 네트워크에 연결된 장치다.
# 방화벽 종류
## Traditional packet filters
- 조직의 네트워크와 ISP를 연결하는 게이트웨이 라우터 안에서 패킷 필터링을 한다.
- 패킷 필터는 각 데이터그램을 개별적으로 검사한다.
- 관리자가 지정한 규칙에 따라 데이터그램을 통과시킬지 아니면 삭제할지 결정한다.
- 필터링하는 요소들:
	- 출발지 IP 주소, 목적지 IP 주소
	- IP 데이터그램 필드의 프로토콜 타입(TCP, UDP, ICMP, OSPF 등)
	- TCP, UDP의 출발지 포트와 목적지 포트
	- TCP 플래그 비트(SYN, ACK 등)
	- ICMP 메시지 타입
	- 데이터그램의 방향
	- 라우터 인터페이스

- 방화벽 규칙은 **접근 제어 목록(Access Control List, ACL)** 으로 구현된다.
- 라우터 인터페이스마다 별도의 목록을 가진다.
- IP 주소 스푸핑 공격에는 취약하다.
- 외부에서 내부로의 TCP 연결 시작은 막으면서 내부에서 외부로의 연결에 대한 응답은 허용하고 싶을 때, 무조건 ACK 비트가 설정된 패킷을 허용하면 공격자가 이를 악용해 내부망을 스캔하거나 공격할 수 있다.
## Stateful Packet Filters
- 상태 기반 필터는 TCP 연결 상태를 추적한다.
- 방화벽은 3-way handshake(SYN, SYNACK, ACK)를 관찰하여 새로운 연결의 시작을 감지하고, FIN 패킷을 통해 연결 종료를 감지한다.
- 일정 시간 동안 활동이 없으면 연결이 종료된 것으로 간주한다.
- 상태 기반 필터는 **연결 테이블(connection table)** 을 통해 현재 진행 중인 TCP 연결을 추적한다.
	![[stateful_filter_connection_table.png]]
- ACL에 **연결 확인(check connection)** 항목을 추가하여, 외부에서 들어오는 패킷이 현재 진행 중인 유효한 연결에 속해 있는지 연결 테이블을 통해 확인한 후 통과시킨다.
	![[stateful_filter_acl.png]]
- 단순히 ACK 비트만 설정된 악의적인 패킷을 차단할 수 있다.
## Application Gateway
- 패킷 필터는 IP 주소나 포트 번호와 같은 헤더 정보만으로 필터링하기 때문에, 특정 사용자의 권한이나 애플리케이션 데이터 내용에 기반한 정교한 제어는 어렵다.
- 애플리케이션 게이트웨이는 이러한 정교한 제어를 위해 사용된다.
- 애플리케이션 게이트웨이는 애플리케이션마다 별도로 필요하며, 모든 데이터가 게이트웨이를 거쳐야 하므로 성능 저하가 발생할 수 있다.