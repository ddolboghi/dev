# 보안 이메일의 요구사항
송신자가 수신자에게 이메일을 보낼 때, 침입자에 대비해 다음과 같은 보안 기능이 필요하다.
1. **기밀성**: 송신자와 수신자 외에는 아무도 내용을 읽을 수 없어야 한다.
2. **송신자 인증**: 수신자는 메시지가 침입자가 아닌 송신자가 보낸 것임을 확신할 수 있어야 한다.
3. **메시지 무결성**: 메시지가 전송 중에 변조되지 않았음을 보장해야 한다.
4. **수신자 인증**: 송신자는 메시지가 침입자가 아닌 수신자에게 전달됨을 확신할 수 있어야 한다.

## 기밀성 확보를 위한 설계
- 대칭키 암호화는 키 분배 문제가 있다.
- 공개키 암호화는 긴 메시지에 대해 효율이 떨어진다.
- 두 문제를 해결하기 위해 **세션 키**를 사용한다. 

![[session_key.png]]
1. 송신자는 임의의 대칭 세션 키($K_S$)를 생성한다.
2. 메시지($m$)를 세션 키($K_S$)로 암호화한다.
3. 세션 키($K_S$) 자체를 송신자의 공개키($K_B^+$)로 암호화한다.
4. 암호화된 메시지와 암호화된 세션 키를 결합하여 송신자에게 전송한다.
5. 송신자는 자신의 개인키($K_B^-$)로 세션 키를 복호화한 뒤, 그 세션 키로 메시지를 복호화한다.

## 송신자 인증과 메시지 무결성을 위한 설계
- 기밀성을 제외하고, 인증과 무결성을 위해 **전자 서명**(Digital Signature)과 **메시지 다이제스트**(Message Digest)를 사용한다.

![[email_digital_signature.png]]
1. 송신자는 메시지($m$)에 **해시 함수**($H$)를 적용하여 메시지 다이제스트를 얻는다.
2. 이 다이제스트를 송신자의 개인키($K_A^-$)로 서명(암호화)하여 **전자 서명**을 생성한다.
3. 원본 메시지와 전자 서명을 결합하여 수신자에게 보낸다.
4. 수신자는 송신자의 공개키($K_A^+$)를 이용해 서명을 복호화하고, 원본 메시지의 해시값과 비교하여 일치 여부를 확인한다.
## 통합 보안 이메일 시스템 설계
- 기밀성, 송신자 인증, 메시지 무결성을 모두 제공하기 위해 앞선 두 가지 방식(세션 키, 전자 서명)을 결합한다.

![[email_security.png]]
1. 송신자는 원본 메시지와 그 메시지의 서명된 해시(전자 서명)를 결합하여 하나의 '패키지'를 만든다.
2. 이 패키지 전체를 임의로 생성한 세션 키($K_S$)로 암호화한다.
3. 세션 키($K_S$)는 수신자의 공개키($K_B^+$)로 암호화하여 패키지에 덧붙여 전송한다.
4. 수신자는 자신의 개인키로 세션 키를 복호화하고, 세션 키로 패키지를 복호화한 뒤, 송신자의 공개키로 서명을 검증한다.

- 이 방식에서 송신자와 수신자는 각각 **공개키 암호화를 두 번씩 사용**한다(자신의 개인키 한 번, 상대방의 공개키 한 번). 
- 상대방의 올바른 공개키를 획득해야 하는 키 분배 문제는 여전히 존재하며, 이는 인증 기관(CA)을 통해 해결해야 한다.

# PGP (Pretty Good Privacy)
- PGP는 이메일 암호화와 동일한 구조를 가진다.
- 알고리즘: PGP 소프트웨어는 버전에 따라 다양한 알고리즘을 사용한다.
    - 메시지 다이제스트: MD5 또는 SHA
    - 대칭키 암호화: CAST, Triple-DES, IDEA
    - 공개키 암호화: RSA

- 키 관리: PGP 설치 시 사용자의 공개키 쌍을 생성한다. 공개키는 웹사이트나 공개키 서버에 게시하고, 개인키는 사용자가 설정한 비밀번호로 보호된다.
- 기능: 사용자는 메시지에 대해 전자 서명만 할지, 암호화만 할지, 아니면 둘 다 할지 선택할 수 있다.

## PGP 메시지 형식
다음은 PGP로 서명된 메시지의 예시다:
```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
Bob: Can I see you tonight? Passionately yours, Alice
-----BEGIN PGP SIGNATURE-----
Version: PGP for Personal Privacy 5.0
Charset: noconv
yhHJRHhGJGhgg/12EpJ+lo8gE4vB3mqJhFEvZP9t6n7G6m5Gw2
-----END PGP SIGNATURE-----
-----BEGIN PGP MESSAGE-----
Version: PGP for Personal Privacy 5.0 u2R4d+/jKmn8Bc5+hgDsqAewsDfrGdszX68liKm5F6Gc4sDfcXyt RfdS10juHgbcfDssWe7/K=lKhnMikLo0+1/BvcX4t==Ujk9PbcD4
Thdf2awQfgHbnmKlok8iy6gThlp
-----END PGP MESSAGE
```
- 메시지는 MIME 헤더 뒤에 나타나며, 인코딩된 데이터는 디지털 서명된 메시지 다이제스트($K_A^-(H(m))$)를 포함한다. 
- 수신자가 메시지의 무결성을 검증하기 위해서는 송신자의 공개키가 필요하다.