# 라우터 구성 요소
![[router_architecture.png]]
### 입력 포트(Input port)
- 라우터로 들어오는 물리적 링크를 종단하는 물리 계층 기능을 수행한다.
- 들어오는 링크의 반대편에 있는 링크 계층과 상호 운용하는 데 필요한 링크 게층 기능도 처리한다.
- 도착한 패킷이 스위칭 구조를 통해 **전달될 출력 포트를 결정하는 조회**(lookup) 기능을 수행한다.
- 제어 패킷(e.g. 라우팅 프로토콜 정보)은 입력 포트에서 라우팅 프로세서로 전달된다.
### 스위칭 구조(Switching fabric)
- 입력 포트와 출력 포트를 연결한다.
- 라우터의 성능을 결정하는 핵심 요소다.
### 출력 포트(Output port)
- 스위칭 구조로부터 받은 패킷을 저장한 후, 이를 출력 링크로 전송하는 데 필요한 링크 계층 및 물리 계층 기능을 수행한다.
- 입력 포트와 마찬가지로, 패킷을 전달하기 전에 조회 및 포워딩 기능을 수행해야 할 수 있다.
### 라우팅 프로세서(Routing processor)
- 제어 평면 기능을 실행한다.
- 전통적인 라우터에서는 라우팅 프로토콜(e.g. OSPF, BGP)을 실행하고, 포워딩 테이블을 유지하며, 라우터의 흐름 제어 및 관리한다.
- SDN 라우터에서는 라우팅 프로세서가 원격 컨트롤러와 통신하여 컨트롤러가 계산한 포워딩 테이블을 수신하고, 이를 라우터의 입력 포트에 설치한다.
# 라우터 기능 구분
### 데이터 평면(Data Plane)
- 데이터그램을 입력 포트에서 출력 포트로 전달(포워딩)
- 나노초 단위의 매우 짧은 시간 내에 처리되어야 하므로 주로 하드웨어에 구현
- 라우터의 포워딩 평면(forwarding plane)이라고도 한다.
- 입력 및 출력 포트 기능은 데이터 평면의 일부다.
### 제어 평면(Control Plane)
- 네트워크 전체에 걸쳐 데이터그램이 송신지에서 목적지까지 어떻게 라우팅될지 결정
- 라우팅 프로토콜을 통해 이뤄진다.
- 밀리초 또는 초 단위로 작동하며 주로 소프트웨어로 구현되어 라우팅 프로세서(CPU)에서 실행된다.
- 제어 평면의 접근 방식은 전통적인 라우터별 제어([[Network Layer의 개요#전통적인 접근 방식]])와 SDN([[Network Layer의 개요#SDN(Software-Defined Networking) 접근 방식]])이 있다.

포워딩 테이블은 라우팅 프로세서(제어 평면)에 의해 계산되거나 컨트롤러부터 수신된 후, 각 입력 포트(포워딩 평면)에 설치된다. 이러한 분리된 접근 방식 덕분에 라우터는 **패킷별로 제어 평면의 개입 없이** 매우 빠르게 패킷을 포워딩할 수 있다.

# 입력 포트 처리와 목적지 기반 포워딩
## 입력 포트의 기능
- **물리 계층 및 링크 계층 기능**: 입력 포트는 라우터로 들어오는 물리적 링크를 종단하는 물리 계층 기능을 수행하고, 들어오는 링크의 반대편에 있는 링크 계층과 상호 운용하는 데 필요한 링크 계층 기능도 처리한다.
- **조회(Lookup) 기능**: 라우터의 핵심 동작인 조회 기능이 입력 포트에서 수행된다. 여기서 포워딩 테이블을 참조하여 도착한 패킷이 스위칭 구조를 통해 어느 출력 포트로 전달될지 결정한다.
    - 포워딩 테이블은 라우팅 프로세서에서 각 라인 카드로 복사되어, 패킷별로 중앙 라우팅 프로세서를 호출하지 않고도 각 입력 포트에서 로컬로 포워딩 결정을 내릴 수 있게 한다. 이는 중앙 처리 병목 현상을 방지한다.
## 목적지 기반 포워딩 테이블의 구조
- 가장 간단한 경우, 패킷의 출력 포트는 패킷의 목적지 주소에 따라 결정된다.
- 32비트 IP 주소에 대해 모든 가능한 목적지 주소마다 항목을 갖는 포워딩 테이블을 만드는 것은 40억 개 이상의 항목이 필요하므로 현실적으로 불가능하다.
- **접두어 일치(Prefix Matching)**: 이러한 확장성 문제를 해결하기 위해 라우터는 패킷 목적지 주소의 **접두어**를 테이블 항목과 비교한다.
    - 예를 들어, 4개의 링크(0-3)를 가진 라우터가 특정 주소 범위에 따라 패킷을 포워딩해야 할 때, 전체 주소 대신 주소의 앞부분(접두어)만 사용하여 포워딩 테이블을 구성할 수 있다.
    - 만약 목적지 주소가 `11001000 00010111 00010110 10100001`이고, 테이블에 `11001000 00010111 00010`라는 21비트 접두어와 일치하는 항목이 있다면, 라우터는 해당 패킷을 그 항목과 연결된 링크 인터페이스로 포워딩한다.
- 최장 접두어 일치 규치