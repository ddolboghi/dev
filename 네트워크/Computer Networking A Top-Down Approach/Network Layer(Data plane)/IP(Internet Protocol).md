---
chapter: "4"
---
chapter 4.3
## DHCP (Dynamic Host Configuration Protocol)
- 네트워크에 연결된 장치에 IP 주소와 기타 네트워크 설정 정보를 자동으로 할당하는 프로토콜
- DHCP를 이용하면 연결된 장치마다 수동으로 IP 주소를 할당하지 않아도 된다.
- DHCP는 기본 게이트웨이의 IP 주소도 제공한다.
- DHCP 서버는 엣지 라우터에 있다.
- DHCP 서버는 장치가 네트워크에 연결되면 IP 주소를 할당하고, 네트워크 연결이 끊기면 IP 주소를 회수한다.
## DHCP 프로토콜 과정(6.7.1)
chp 4의 4단계 중 마지막 두 단계만 실제로 필요하다.
1. 운영체제가 DHCP 요청 메시지를 UDP 세그먼트에 넣는다. 이때 destination 포트는 DHCP 서버 포트인 67이고, 소스 포트는 DHCP 클라이언트 포트인 68이다. UDP 세그먼트는 브로드캐스트 IP destination 주소와 0.0.0.0의 소스 IP 주소를 가지고 IP 데이터그램안에 위치한다.
2. IP 데이터그램은 이더넷프레임 내에 배치된다. 이더넷프레임은 destination MAC 주소를 가지고 스위치에 연결된 모든 장치들에 전파된다. 이때 이더넷프레임의 소스 MAC 주소는 내 컴퓨터의 MAC 주소다.
3. 2의 이더넷 프레임은 내 컴퓨터가 이더넷 스위치로 전송하는 첫번째 프레임이다. 스위치는 들어온 프레임을 라우터와 연결된 포트를 포함한 모든 아웃 포트로 전파한다.
4. 라우터는 자신의 MAC 주소를 가진 인터페이스에서 DHCP 요청이 포함된 이더넷프레임을 수신하고 이더넷프레임에서 IP 데이터그램을 추출한다. 데이터그램의 브로드캐스트 IP destination 주소는 이 IP 데이터그램이 이 노드에서 상위계층 프로토콜에 의해 처리되어야 함을 나타낸다. 따라서 데이터그램의 페이로드(UDP 세그먼트)는 UDP까지 demultiplexed 되고, DHCP 요청 메지가 UDP 세그먼트로부터 추출된다.
5. 라우터 안에서 돌아가고 있는 DHCP 서버는 CIDR 블록 내의 IP 주소를 할당한다. DHCP 서버는 DHCP ACK 메시지를 만드는데, 이 안에는 할당할 IP 주소, DNS 서버의 IP 주소, 기본 게이트웨이의 IP 주소, subnet block(네트워크 마스크)이 들어있다. DHCP 메시지는 UDP 세그먼트 안에 들어가고, UDP 세그먼트는 IP 데이터그램 안에 들어가며, IP 데이터그램은 이더넷프레임 안에 들어간다. 이더넷프레임 안에는 라우터가 속한 네트워크에 대한 라우터 인터페이스의 소스 MAC 주소와 내 컴퓨터의 destination MAC 주소가 들어있다.
6. DHCP ACK를 포함한 이더넷프레임은 라우터에 의해서 스위치로 보내진다. 스위치는 2에서 DHCP 요청이 포함된 이더넷프레임을 받은 적이 있기 때문에 프레임의 destination MAC 주소를 보고 내 컴퓨터로 연결되는 포트에만 전달한다.
7. 내 컴퓨터는 이더넷프레임을 수신하고나서 IP 데이터그램 -> UDP 세그먼트 -> DHCP ACK 메시지 순서로 추출한다. DHCP 클라이언트는 DHCP ACK 메시지 안에서 할당받은 IP 주소와 DNS 서버의 IP 주소를 기록한다. 그리고 기본 게이트웨이의 주소를 IP 포워딩 테이블에 설치한다. 그러면 이제부터 내 컴퓨터는 subnet 밖의 대상 주소를 갖는 모든 데이터그램을 기본 게이트웨이로 받게 된다. 이제 내 컴퓨터는 네트워크 컴포넌트로 초기화되고, 웹페이지 페치를 시작할 준비를 한다.