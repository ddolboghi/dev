# 링크 계층 주소
## MAC 주소
- 네트워크 인터페이스(물리적인 어댑터)에 할당되는 48bit **고유 식별자로, 이동해도 변하지 않는다.**
- 여러 네트워크 인터페이스를 가진 **호스트나 라우터는 여러 링크 계층 주소**를 가진다.
- 스위치는 데이터그램을 전달하는 역할을 하므로 링크 계층 주소를 할당받지 않는다.
- 16진수로 표기한다.
- IEEE가 MAC 주소를 관리하고, 어댑터 제조사는 IEEE로부터 주소의 일부(24bit)를 구매하여 나머지 24bit를 고유하게 조합하여 할당한다.
- 어댑터가 프레임을 전송할 때 목적지 어댑터의 MAC 주소를 프레임에 삽입하여 LAN으로 보낸다.
- 어댑터는 프레임의 목적지 MAC 주소가 자신의 주소와 일치하면 데이터그램을 추출하여 프로토콜 스택 위로 전달하고, 일치하지 않으면 폐기한다.
- 모든 어댑터가 프레임을 처리할 수 있도록 하려면, 송신 어댑터는 목적지 주소 필드에 MAC 브로드캐스트 주소인 `FF-FF-FF-FF-FF-FF`을 삽입한다.
## ARP(Address Resolution Protocol)
- 송신 호스트와 수신 호스트가 모두 속한 **서브넷 내에서 IP 주소를 MAC 주소로 변환**하는 프로토콜이다.
- **ARP 테이블**을 사용하여 IP 주소와 MAC 주소의 매핑 정보(TTL 값 포함)를 관리한다.
- ARP 테이블에 정보가 없으면 ARP 패킷을  MAC 브로드캐스트 주소로 보내 업데이트한다.
- ARP 테이블은 plug-and-play 방식으로 자동 구축된다.
## 다른 서브넷으로 데이터그램 전송
- 다른 서브넷으로 데이터를 보낼 때, 송신 호스트는 최종 목적지의 MAC 주소가 아닌 **첫 번째 홉 라우터(기본 게이트웨이)의 MAC 주소**를 목적지 주소로 설정하여 프레임을 전송한다.
- 송신 호스트는 ARP를 사용하여 라우터의 MAC 주소를 알아낸다.
- 라우터는 포워딩 테이블을 참조하여 데이터를 보낼 인터페이스를 결정하고, ARP를 통해 최종 목적지의 MAC 주소를 알아내어 새로운 프레임에 캡슐화하여 수신 호스트가 있는 서브넷으로 전송한다.
# Ethernet
- Ethernet은 유선 LAN에 사용되는 기술이다.
- 이더넷은 네트워크 계층에 비연결형 & 비신뢰적 서비스를 제공한다.
	- hand-shaking 없이 프레임을 전송한다.
	- CRC 검사를 통과해도 ACK를 보내지 않으며, 오류 시 프레임을 폐기한다.
- 버스 토폴로지(동축 케이블) -> 허브 기반 스타 토폴로지 -> 스위치 기반 스타 토폴로지로 발전하며 충돌 문제를 해결하고 속도를 높였다.
- 스위치 기반 이터넷 LAN에서는 스위치가 전송을 조정하고 전이중(full-duplex) 방식을 사용하기 때문에 충돌이 발생하지 않아 MAC 프로토콜이 필요없지만, 이더넷 정의상 유지되고 있다.
## Ethernet 프레임 구조
- **데이터 필드(46~1500 byte)**: IP 데이터그램이 들어있다. MTU(Maximum Transmission Unit)는 1500byte이며, 이보다 크면 단편화(fragmentation)해야 한다. 46byte보다 작으면 채우기(stuffing)를 통해 크기를 맞춘다.
- **목적지 주소(6 byte)**: 목적지 어댑터의 MAC 주소다.
- **소스 주소(6byte)**: 프레임을 전송하는 어댑터의 MAC 주소다.
- **타입 필드(2 byte)**: 이더넷이 **상위 프로토콜을 식별**할 수 있게 한다. 즉, 수신 어댑터가 데이터를 어떤 네트워크 계층 프로토콜(IP, ARP 등)로 전달해야 할지 알려준다.
- **Cyclic Redundancy Check(CRC)(4 byte)**: 수신 어댑터가 프레임의 비트 오류를 감지하는데 사용된다.
- **Preamble(8byte)**: 프레임의 시작 부분에 있다. 수신 어댑터를 깨우고 송신자의 클록과 동기화하는 역할을 한다.
# 링크 계층 스위치
- 스위치는 링크 계층 주소(MAC)를 기반으로 프레임을 필터링하고 포워딩한다.
- 호스트나 라우터는 스위치의 존재를 모른다.
- 스위치의 출력 인터페이스에는 프레임 도착 속도가 링크 용량을 초과할 때를 대비하기 위한 **버퍼**가 있다.
## 필터링 & 포워딩
- 필터링: 프레임을 전달할지 폐기할지 결정한다.
- 포워딩: 프레임을 어느 인터페이스로 보낼지 결정하고 이동시킨다.
- 필터링과 포워딩은 **스위치 테이블**을 통해 수행된다.
	- MAC 주소, 해당 MAC 주소로 가능 스위치 인터페이스, 항목이 생성된 시간으로 구성된다.

1. 테이블에 수신 받은 프레임의 목적지 주소가 없을때: 프레임을 수신 받은 인터페이스를 제외한 모든 인터페이스로 브로트캐스트한다.
2. 테이블에 목적지 주소가 있고, 인터페이스가 수신 인터페이스와 같을때: 프레임을 폐기 ㅎ