# 링크 계층 주소
## MAC 주소
- 네트워크 인터페이스(물리적인 어댑터)에 할당되는 48bit **고유 식별자로, 이동해도 변하지 않는다.**
- 여러 네트워크 인터페이스를 가진 **호스트나 라우터는 여러 링크 계층 주소**를 가진다.
- 스위치는 데이터그램을 전달하는 역할을 하므로 링크 계층 주소를 할당받지 않는다.
- 16진수로 표기한다.
- IEEE가 MAC 주소를 관리하고, 어댑터 제조사는 IEEE로부터 주소의 일부(24bit)를 구매하여 나머지 24bit를 고유하게 조합하여 할당한다.
- 어댑터가 프레임을 전송할 때 목적지 어댑터의 MAC 주소를 프레임에 삽입하여 LAN으로 보낸다.
- 어댑터는 프레임의 목적지 MAC 주소가 자신의 주소와 일치하면 데이터그램을 추출하여 프로토콜 스택 위로 전달하고, 일치하지 않으면 폐기한다.
- 모든 어댑터가 프레임을 처리할 수 있도록 하려면, 송신 어댑터는 목적지 주소 필드에 MAC 브로드캐스트 주소인 `FF-FF-FF-FF-FF-FF`을 삽입한다.
## ARP(Address Resolution Protocol)
- 송신 호스트와 수신 호스트가 모두 속한 **서브넷 내에서 IP 주소를 MAC 주소로 변환**하는 프로토콜이다.
- **ARP 테이블**을 사용하여 IP 주소와 MAC 주소의 매핑 정보(TTL 값 포함)를 관리한다.
- ARP 테이블에 정보가 없으면 ARP 패킷을  MAC 브로드캐스트 주소로 보내 업데이트한다.
- ARP 테이블은 plug-and-play 방식으로 자동 구축된다.
## 다른 서브넷으로 데이터그램 전송
- 다른 서브넷으로 데이터를 보낼 때, 송신 호스트는 최종 목적지의 MAC 주소가 아닌 **첫 번째 홉 라우터(기본 게이트웨이)의 MAC 주소**를 목적지 주소로 설정하여 프레임을 전송한다.
- 송신 호스트는 ARP를 사용하여 라우터의 MAC 주소를 알아낸다.
- 라우터는 포워딩 테이블을 참조하여 데이터를 보낼 인터페이스를 결정하고, ARP를 통해 최종 목적지의 MAC 주소를 알아내어 새로운 프레임에 캡슐화하여 수신 호스트가 있는 서브넷으로 전송한다.
# Ethernet
- Ethernet은 유선 LAN에 사용되는 기술이다.
- 이더넷은 네트워크 계층에 비연결형 & 비신뢰적 서비스를 제공한다.
	- hand-shaking 없이 프레임을 전송한다.
	- CRC 검사를 통과해도 ACK를 보내지 않으며, 오류 시 프레임을 폐기한다.
- 버스 토폴로지(동축 케이블) -> 허브 기반 스타 토폴로지 -> 스위치 기반 스타 토폴로지로 발전하며 충돌 문제를 해결하고 속도를 높였다.
- 스위치 기반 이터넷 LAN에서는 스위치가 전송을 조정하고 전이중(full-duplex) 방식을 사용하기 때문에 충돌이 발생하지 않아 MAC 프로토콜이 필요없지만, 이더넷 정의상 유지되고 있다.
## Ethernet 프레임 구조
- **데이터 필드(46~1500 byte)**: IP 데이터그램이 들어있다. MTU(Maximum Transmission Unit)는 1500byte이며, 이보다 크면 단편화(fragmentation)해야 한다. 46byte보다 작으면 채우기(stuffing)를 통해 크기를 맞춘다.
- **목적지 주소(6 byte)**: 목적지 어댑터의 MAC 주소다.
- **소스 주소(6byte)**: 프레임을 전송하는 어댑터의 MAC 주소다.
- **타입 필드(2 byte)**: 이더넷이 **상위 프로토콜을 식별**할 수 있게 한다. 즉, 수신 어댑터가 데이터를 어떤 네트워크 계층 프로토콜(IP, ARP 등)로 전달해야 할지 알려준다.
- **Cyclic Redundancy Check(CRC)(4 byte)**: 수신 어댑터가 프레임의 비트 오류를 감지하는데 사용된다.
- **Preamble(8byte)**: 프레임의 시작 부분에 있다. 수신 어댑터를 깨우고 송신자의 클록과 동기화하는 역할을 한다.
# 링크 계층 스위치
- 스위치는 링크 계층 주소(MAC)를 기반으로 프레임을 필터링하고 포워딩한다.
- 호스트나 라우터는 스위치의 존재를 모른다.
- 스위치의 출력 인터페이스에는 프레임 도착 속도가 링크 용량을 초과할 때를 대비하기 위한 **버퍼**가 있다.
## 필터링 & 포워딩
- 필터링: 프레임을 전달할지 폐기할지 결정한다.
- 포워딩: 프레임을 어느 인터페이스로 보낼지 결정하고 이동시킨다.
- 필터링과 포워딩은 **스위치 테이블**을 통해 수행된다.
	- **MAC 주소**, **해당 MAC 주소로 가는 스위치 인터페이스**, **항목이 생성된 시간**으로 구성된다.

1. 테이블에 수신 받은 프레임의 목적지 주소가 없을때: 프레임을 수신 받은 인터페이스를 제외한 모든 인터페이스로 브로트캐스트한다.
2. 테이블에 목적지 주소가 있고, 인터페이스가 수신 인터페이스와 같을때: 프레임을 폐기한다.
3. 테이블에 목적지 주소가 있고, 인터페이스가 수신 인터페이스가 아닐때: 프레임을 목적 인터페이스의 출력 버퍼로 전달(포워딩)한다.
## 자가 학습(self-learning)
- 스위치 테이블은 plug-and-play 장치인 자가 학습을 통해 자동으로 구축된다.

1. 초기에는 스위치 테이블이 비어 있다.
2. 인터페이스로 프레임이 수신될 때마다 스위치는 **프레임이 발송된 MAC 주소**, **프레임이 도착한 인터페스**, **현재 시간**을 테이블에 저장한다. -> 송신자가 어느 LAN에 있는지 학습한다.
3. 일정 시간 동안 프레임이 수신되지 않은 주소는 테이블에서 삭제한다.
## 스위치 사용의 장점
- 스위치는 프레임을 버퍼링하고 한 번에 하나의 프레임만 세그먼트로 전송하므로 충돌로 인한 대역폭 낭비가 없다.
- LAN 내의 각 링크가 서로 다른 속도와 매체(광섬유, 구리선 등)를 사용할 수 있어 기존 장비와 새 장비를 혼합하기 좋다.
- 오작동하는 어댑터를 감지하고 격리하거나, 케이블 단선 시 영향 범위를 해당 호스트로 제한하는 등 네트워크 관리를 용이하게 한다. 트래픽 통계 수집도 가능하다.
## 스위치 vs 라우터
- **라우터는 3계층 패킷 스위치이고 스위치는 2계층 패킷 스위치**이다.
- 스위치는 설정이 쉽고 빠르지만 브로드캐스트 제어가 어렵고, 라우터는 경로 제어와 격리가 뛰어나지만 설정이 필요하다.
- 일반적으로 수백 개의 호스트로 구성된 소규모 네트워크에는 스위치가 적합하고, 수천 개의 호스트로 구성된 대규모 네트워크에는 트래픽 격리와 제어를 위해 라우터가 필요하다

- 스위치의 장단점: 플러그 앤 플레이가 가능하고 패킷 처리 속도가 빠르다(2계층까지만 처리). 하지만 활성 토폴로지가 스패닝 트리로 제한되어야 브로드캐스트 순환을 막을 수 있고, 대규모 네트워크에서는 ARP 트래픽 처리 부담이 크며 브로드캐스트 폭풍에 취약하다.
    
- 라우터의 장단점: 계층적 주소 지정 덕분에 스패닝 트리 제한 없이 최적의 경로를 사용할 수 있고 브로드캐스트 폭풍에 대한 방화벽 역할을 한다. 하지만 플러그 앤 플레이가 아니며(IP 설정 필요), 3계층 처리로 인해 패킷 처리 시간이 더 걸릴 수 있다.
# VLAN(Virtual LAN)
- VLAN을 지원하는 스위치는 **단일 물리적 스위치 내**에서 논리적으로 네트워크를 분할하여 여러 **가상 LAN**을 생성할 수 있다.
- VLAN은 **트래픽 격리**, **스위치 효율성 증대**, **사용자 관리 편의성**을 제공한다.
- 포트 기반으로 브로드캐스트 도메인을 나누며, 서로 다른 VLAN 간 통신을 위해서는 라우터가 필요하다.
	- 스위치 포트 하나를 외부 라우터에 연결하거나, 스위치 내부에 통합된 라우팅 기능을 사용한다.
## VLAN Trunking
- 여러 스위치에 걸쳐 VLAN을 확장할 때 사용한다.
- 각 스위치의 트렁크 포트를 연결하여 모든 VLAN의 프레임을 전달한다.
- 이더넷 프레임 헤더에 4byte의 **VLAN 태그**(프로토콜 식별자, 제어 정보, VLAN ID(12bit))를 추가하여 프레임이 속한 VLAN을 식별한다.
- VLAN 태그는 송신 측 스위치에서 추가되고 수신 측 스위치에서 제거된다.