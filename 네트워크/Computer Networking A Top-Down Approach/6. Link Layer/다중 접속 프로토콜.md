- 링크는 **점대점**(point-to-point)과 **브로드캐스트** 두 유형으로 나뉜다. 
- 브로드캐스트 링크는 여러 노드가 하나의 매체를 공유하며, 이때 둘 이상의 노드가 동시에 전송하면 충돌이 발생하여 모든 데이터가 손실된다.
- 이 **다중 접속 문제**를 해결하기 위해 **다중 접속 프로토콜(MAC 프로토콜)** 이 필요하며, 이는 노드들의 전송 시점을 분산된 방식으로 조정한다. 즉, 모든 노드가 동등하며 다중 접속 프로토콜은 각 노드에서 자율적으로 실행된다.
- MAC 프로토콜은 크게 **채널 분할**, **임의 접속**, **순번제**의 세 가지 범주로 나뉜다.
# 채널 분할 프로토콜(Channel Partitioning Protocols)
- 채널 분할 프로토콜은 $R$ bps의 채널을 $N$개의 노드에게 나누어 충돌을 원천적으로 방지한다.
## TDM (Time Division Multiplexing, 시분할 다중화)
- TDM은 시간을 일정한 길이의 라운드로 나누고, 각 라운드를 $N$개의 시간 슬롯(time slots)으로 다시 나눈다. $i$번째 노드($i=1, ..., N$)는 각 라운드의 $i$번째 시간 슬롯 동안에만 프레임을 전송할 수 있다.
- 장점: 충돌을 제거하고 각 노드에 $R/N$의 전용 전송률을 보장하여 공정하다.
- 단점: 
	- 노드는 자신의 슬롯이 돌아올 때까지 기다려야 하므로 항상 평균 $R/N$의 속도만 얻는다.
	- 노드가 전송할 패킷이 없는 경우에도 해당 슬롯은 **유휴 상태(idle)** 로 유지되어 낭비된다.
## FDM (Frequency Division Multiplexing, 주파수 분할 다중화)
- FDM은 $R$ bps의 채널을 $N$개의 서로 다른 주파수 대역($F_1, ..., F_N$)으로 분할하고, 각 노드에 하나의 대역을 할당한다. 각 대역은 $R/N$의 용량을 갖는다.
- TDM과 동일한 장점(충돌 없음, 공정성)과 단점(비효율성)을 공유한다. TDM이 시간을 공유하는 반면 FDM은 주파수를 공유한다는 점만 다르다.
## CDMA (Code Division Multiple Access, 코드 분할 다중 접속)
- CDMA는 각 노드에 고유한 **코드(code)**(칩핑 시퀀스)를 할당한다.
- 각 노드는 자신의 코드를 사용하여 전송할 데이터를 인코딩한다.
- 여러 노드가 동일한 주파수에서 **동시에 전송**할 수 있다.
- 수신자는 송신자의 고유한 코드를 사용하여 다른 전송과 구별되는 원하는 신호를 추출할 수 있다.
# 랜덤 액세스 프로토콜(Random Access Protocols)
- 노드가 항상 채널의 전체 속도($R$ bps)로 전송한다.
- 충돌한 노드들은 **랜덤 지연**후 프레임을 재전송한다.
- 트래픽이 예측 불가능하고 간헐적이고 부하가 낮을 때 효율적이다.
## Slotted ALOHA
Slotted ALOHA 프로토콜은 다음 가정을 기반으로 작동한다:
1. 모든 프레임은 동일한 크기 $L$을 갖는다.
2. 시간은 $L/R$초 크기의 슬롯으로 나뉜다.(슬롯 하나는 프레임 하나를 전송하는 시간)
3. 노드는 **슬롯의 시작 시점**에서만 프레임 전송을 시작한다.
4. 노드들은 동기화되어 각 노드가 언제 슬롯이 시작되는지 안다.
5. 만약 두 개 이상의 프레임이 한 슬롯에서 충돌하면, 모든 노드는 슬롯이 끝나기 전에 충돌 이벤트를 감지한다.
### 동작 원리
- 노드가 전송할 새 프레임이 있다면, 다음 슬롯이 시작될 때까지 기다렸다가 전체 프레임을 전송한다.
- 만약 충돌이 발생하면, 노드는 슬롯이 끝나기 전에 충돌을 감지한다. 노드는 $p$의 확률로 다음 슬롯에서 프레임을 재전송하거나, $1-p$의 확률로 한 슬롯을 기다린다. 프레임이 충돌 없이 전송될 때까지 이를 반복한다.
### 한계
- 하나의 노드만 활성 상태일 때 채널의 전체 속도 $R$을 사용할 수 있어 매우 효율적이다.
- 노드가 많아지면 충돌이 빈번해져 채널 효율이 떨어진다.
## CSMA (Carrier Sense Multiple Access)
- CSMA에서 노드는 **채널이 유휴 상태일때만** 프레임을 전송한다.
- 채널이 사용 중(busy)이라고 감지되면, 유휴 상태가 될 때까지 전송을 미룬다.
- **채널 전파 지연**(노드 간 전송에 시간이 듦)으로 인해 채널이 유휴 상태라고 잘못 판단하고 전송하면 충돌이 발생한다.
## CSMA/CD (충돌 탐지(Collision Detection, CD) CSMA)
- CSMA/CD에서 노드는 프레임을 전송하는 동시에 채널을 계속 감지한다.
- 충돌이 발생하면 노드는 전송을 즉시 중단한다.
> [!TIP]
    > CSMA/CD는 Ethernet의 핵심 MAC 프로토콜로, "말하기 전에 듣고, 말하는 동안 듣는" 방식이다.
### 동작 원리
1. 어댑터가 네트워크 계층에서 데이터그램을 받아 링크 계층 프레임을 준비하고 어댑터 버퍼에 넣는다.
2. 채널이 유휴 상태(idle)라고 감지되면 프레임 전송을 시작한다. 채널이 사용 중(busy)이라고 감지되면, 신호가 감지되지 않을 때까지 기다린 후 프레임 전송을 시작한다.
3. 전송하는 동안, 어댑터는 다른 어댑터로부터 오는 신호를 모니터링한다.
4. 다른 어댑터의 신호를 감지하지 않고 프레임 전체를 전송하면, 어댑터는 해당 프레임 작업을 완료한다. 만약 전송 중에 다른 어댑터의 신호를 감지하면, 전송을 중단한다.
5. 전송을 중단한 후, 어댑터는 랜덤한 시간 동안 기다린 2단계로 돌아간다.
### 이진 지수적 백오프(Binary Exponential Backoff) 알고리즘
- 충돌 후 노드가 재전송을 시도할 때 기다리는 랜덤한 시간을 정하는 알고리즘이다.
- 프레임이 $n$번의 충돌을 겪으면, 노드는 $0$부터 $2^n - 1$ 사이의 정수 $K$를 랜덤하게 선택한다.
- 이더넷의 경우, 노드는 $K \cdot 512$ 비트 시간만큼 기다린 후 CSMA 과정을 시작한다.
- 충돌이 반복될수록($m$이 증가할수록), 대기 시간의 범위가 지수적으로 늘어나므로 충돌 해소 가능성이 커진다.
### 효율성
- CSMA/CD의 효율성은 $d_{prop}$ (최대 전파 지연)와 $d_{trans}$ (최대 크기 프레임 전송 시간)의 비율에 따라 결정되며, 다음과 같은 근사식으로 표현된다. $$efficiency = \frac{1} {1 + 5 d_{prop} / d_{trans}}$$
- 최대 전파 지연이 0에 근접하거나 최대 크기 프레임 전송 시간이 매우 커지면 효율성은 1에 근접한다.
- 전파 지연이 0이면 충돌 노드가 즉시 중단하여 채널 낭비가 없고, 프레임이 매우 길면 채널 가동률이 높아진다.

# 순번제 프로토콜(Taking-turns Protocols)
- 순번제 프로토콜은 충돌 없이 채널을 효율적으로 사용하기 위해 노드들이 차례를 지키도록 한다.
## Polling 프로토콜
- polling은 중앙 집중 방식으로, 마스터 노드가 라운드 로빈 방식으로 각 노드를 poll한다.
### 동작 원리
1. 마스터 노드는 첫 번째 노드에게 poll 메시지를 보내 전송할 프레임이 있는지 묻는다.
2. 첫 번째 노드는 최대 개수까지 프레임을 전송한 뒤 마스터에게 완료했다고 알린다.
3. 나머지 노드들에게 순서대로 1, 2번을 반복한다.
### 한계
- 노드가 polling될 때까지 기다려야 하는 polling delay가 발생한다.
- 마스터 노드가 고장나면 전체 채널이 멈추는 단일 지점 장애 문제가 있다.
## Token-Passing 프로토콜
- 마스터 노드가 없는 대신, **토큰**이라는 프레임이 노드들 사이에서 미리 정해진 순서로 교환된다.
- 토큰을 가진 노드만이 전송 권한을 갖는 분산 방식으로, 높은 효율을 보인다.
- FDDI 프로토콜과 IEEE 802.5 토큰 링 프로토콜은 토큰 전달 프로토콜이다.
### 동작 원리
1. 노드가 토큰을 수신하면, 전송할 프레임이 있는지 확인한다.
2. 프레임이 있다면 노드는 토큰을 최대 개수만큼 프레임을 전송한 뒤, 토큰을 다음 노드로 전달한다.
3. 전송할 프레임이 없다면, 즉시 토큰을 다음 노드로 전달한다.
### 한계
- 한 노드의 장애가 전체 채널을 다운시킬 수 있다.
- 한 노드가 실수로 토큰을 해제하지 않으면, 토큰을 다시 순환시키기 위한 복구 절차가 필요하다.
# DOCSIS
- Data-Over-Cable Service Interface Specifications는 케이블 인터넷 액세스를 위한 프로토콜이다.
- 케이블 액세스 네트워크는 수천 개의 주거용 케이블 모뎀을 케이블 네트워크 헤드엔드의 CMTS(케이블 모뎀 종료 시스템)에 연결한다.
- 케이블 액세스 네트워크는 FDM, TDM, 랜덤 액세스, 순번제가 모두 하나의 네트워크 내에 결합된 다중 접속 프로토콜이다.
## 채널 구조
- FDM을 사용해 업스트림(모뎀 -> CMTS)과 다운스트림(CMTS -> 모뎀) **채널을 분리**한다. 각 채널은 브로드캐스트 채널이다.
- 다운스트림: CMTS에서 전송된 프레임은 해당 채널을 수신하는 모든 케이블 모뎀이 받는다. 다운스트림 채널에는 단 하나의 송신자(CMTS)만 있으므로 다중 접속 문제가 없다.
- 업스트림: 여러 케이블 모뎀이 동일한 업스트림 채널(주파수)을 CMTS로 공유하기 때문에 충돌이 발생할 수 있다.
## 업스트림 다중 접속
### TDM 및 중앙 할당 (순번제)
- 각 업스트림 채널은 시간 간격으로 나뉘며, 각 간격은 케이블 모뎀이 CMTS로 전송할 수 있는 '미니 슬롯'의 시퀀스를 포함한다.
- CMTS는 다운스트림 채널의 제어 메시지(MAP 메시지)를 통해 특정 케이블 모뎀에 특정 미니 슬롯을 할당하여 그 시간 간격 동안 프레임을 전송할 수 있도록 한다.
- 미니 슬롯 동안 충돌이 발생하지 않는다.
### 랜덤 액세스
- 케이블 모뎀이 CMTS에 자신을 알리기 위해, CMTS에 '미니 슬롯 요청 프레임'을 전송한다.
- 이 요청 프레임들은 랜덤 액세스 방식으로 전송되므로 서로 충돌할 수 있다.
### 충돌 처리
- 케이블 모뎀은 업스트림 채널이 사용 중인지 감지할 수 없으며 충돌도 감지할 수 없다.
- 케이블 모뎀은 응답(MAP 메시지)을 받지 못하면 자신의 미니 슬롯 요청 프레임이 충돌을 겪었다고 '추론'한다. 
- 충돌이 추론되면, 케이블 모뎀은 이진 지수 백오프를 사용하여 요청 프레임 재전송을 시도한다.