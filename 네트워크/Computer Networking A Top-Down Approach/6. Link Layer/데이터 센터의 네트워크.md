# 데이터 센터 아키텍처
- 대규모 데이터 센터 비용의 상당 부분은 호스트 장비, 전력 및 냉각 인프라, 전력 비용, 네트워킹 장비가 차지한다.
- 호스트는 **블레이드(blade)** 라고 불리며, CPU, 메모리, 디스크 스토리지를 포함하는 하드웨어로 구성된다.
- 호스트들은 랙(rack)에 쌓이며 랙 상단에 있는 **TOR(Top of Rack) 스위치**가 호스트들을 연결하고 다른 스위치들과 연결한다.
- 데이터 센터 네트워크는 **경계 라우터(border router)를 통해 인터넷과 연결**된다.
- 데이터 센터 내부 네트워크는 랙들을 서로 연결하고 경계 라우터와 연결한다.
## 로드 밸런싱
- 데이터 센터 내부로 들어온 요청은 먼저 로드 밸런서로 전달된다.
- 로드 밸런서는 현재 부하 상태에 따라 요청을 호스트들에게 분산시킨다.
- 로드 밸런서는 목적지 포트 번호뿐만 아니라 **목적지 IP 주소**를 기반으로 결정을 내리기 때문에 layer-4 스위치라고도 불린다.
- 로드 밸런서는 **외부의 공개 IP 주소를 내부 호스트의 사설 IP 주소로 변환**하는 NAT과 유사한 기능을 제공하여 내부 네트워크 구조를 숨기고 보안을 강화한다.
## 계층적 아키텍처
![[data_center_network_hierarchical_topology.png]]
- 수십만 개의 호스트로 확장하려면 라우터와 스위치의 계층 구조가 필수다.
- 가용성을 높이기 위해 호스트는 네트워크 장비와 링크를 중복으로 구성한다. 예를 들어, 각 TOR 스위치는 두 개의 2계층 스위치와 연결되며, 액세스 라우터나 1, 2계층 스위치들도 중복으로 구성될 수 있다.
- 이로 인해 같은 랙에 있는 호스트들 간에는 통신 속도가 빠르지만, 서로 다른 랙에 있는 호스트 간에는 용량 제한, 즉 **최대 전송 속도가 낮아질 수 있다**. 예를 들어, 상위 계층 링크를 공유하는 트래픽이 많아지면 각 통신이 사용할 수 있는 대역폭이 줄어든다.
### 호스트 속도 제한 해결책
- 더 높은 속도의 스위치와 라우터 사용 -> 비싼 장비
- 랙 간 통신 최소화를 위해 관련 서비스와 데이터의 근접 배치 -> 유연성 저해
- **계층 간 연결성 증대** -> TOR 스위치와 2계층 스위치, 2계층과 1계층 스위치 간의 연결 증가 ->랙 간 다중 경로 제공 -> 용량 및 신뢰성 증가, **다중 경로 라우팅**, **ECMP** 기법 사용
# 데이터 센터 네트워크 트렌드
## 비용 절감
- 고가의 장비 대신 저렴한 스위치로 구성된 고도로 연결된 계층적 네트워크 사용
	Clos 네트워크: 다단계의 스위치들이 서로 연결된 네트워크
	![[Clos_network.png]]
## 중앙화된 SDN
- SDN과 유사한 논리적 중앙 집중형 제어 방식 사용
- 단순한 스위치로 구성된 데이터 plan과 소프트웨어 기반의 제어 plan을 명확히 분리
- 자동화된 설정 및 상태 관리 중시
## 가상화
- 가상 머신(VM)은 소프트웨어를 물리적 하드웨어로부터 분리하여 VM을 물리적 서버 간에 원활하게 이동시킬 수 있다.
- 표준 이더넷과 IP는 서버 간 네트워크 연결을 유지하면서 VM을 이동시키는데 한계가 있어, 데이터 센터 네트워크 전체를 하나의 평면적인 2계층 네트워크처럼 취급하는 방식을 사용한다.
  예를 들어, ARP 메커니즘을 브로드캐스트 대신 DNS 스타일의 쿼리로 수정하여, VM에 할당된 IP 주소와 연결된 물리적 스위치를 매핑하는 디렉토리를 유지한다.
## 물리적 제약
- 데이터 센터 네트워크는 매우 높은 용량과 극도로 낮은 지연 시간을 가진다.
- 패킷 손실이나 타임아웃이 발생하면 효율성이 크게 떨어지므로 혼잡 제어 프로토콜이 매우 빠르게 반응해야 한다.
- 데이터 센터 전용 DCTCP나 표준 이더넷 상에서의 RDMA(Remote Direct Memory Access) 구현 등을 사용한다.
## 하드웨어 모듈화 및 커스텀
- 공장에서 **실제 선박용 컨테이너 안에 미니 테이터 센터**를 구축하여, 현장에서 여러 컨테이너를 연결하여 모듈식 데이터 센터를 운영한다.
- 컨테이너는 수리가 어려워 성능이 서서히 저하되도록 설계되며, 성능이 임계치 이하로 떨어지면 컨테이너를 교체한다.
- 대형 클라우드 제공업체들은 거의 모든 장비나 소프트웨어를 맞춤 제작한다.
- AWS가 개척한 **가용성 영역(availability zone)** 은 서로 다른 인근 건물에 데이터 센터를 복제하여 신뢰성을 높인다.