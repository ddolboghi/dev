OpenFlow 프로토콜은 SDN 컨트롤러와 SDN 제어 스위치(또는 OpenFlow API를 구현하는 다른 장치) 간에 작동한다.
OpenFlow 프로토콜은 **TCP** 상에서 작동하며, 기본 포트 번호는 **6653**이다.
# 메시지 유형
## 컨트롤러 -> 스위치
- **Configuration**: 컨트롤러가 스위치의 구성 매개변수를 질의하고 설정할 수 있게 한다.
- **Modify-State**: 컨트롤러가 스위치의 플로우 테이블 항목을 추가/삭제/수정하고, 스위치 포트 속성을 설정하는 데 사용된다.
- **Read-State**: 컨트롤러가 스위치의 플로우 테이블과 포트에서 통계 및 카운터 값을 수집하는 데 사용된다.
- **Send-Packet:** 컨트롤러가 특정 패킷을 제어 대상 스위치의 지정된 포트를 통해 전송시키는 데 사용된다. 이 메시지 자체의 페이로드에 전송할 패킷이 포함된다.   
## 스위치 -> 컨트롤러
- **Flow-Removed**: 플로우 테이블 항목이 (e.g. 타임아웃 또는 수신된 `Modify-State` 메시지의 결과로) 제거되었음을 컨트롤러에 알리는 데 사용된다.
- **Port-status**: 스위치가 포트 상태의 변경을 컨트롤러에 알리는 데 사용된다.
- **Packet-in**: 플로우 테이블과 일치하지 않는 패킷 또는 '컨트롤러로 전송'이 액션으로 지정된 패킷을 컨트롤러로 보내는 데 사용된다.

# SDN 제어 스위치와 SDN 컨트롤러 상호작용 예시
![[SDN_controller_example.png]]
- 다익스트라 알고리즘은 패킷 스위치 외부의 **별도 애플리케이션으로 실행**된다.
- 패킷 스위치는 링크 업데이트를 서로에게 전송하는 것이 아니라 **SDN 컨트롤러에 전송**한다.
### 가정
- s1과 s2 사이의 링크에 장애가 발생했다.
- 최단 경로 라우팅이 구현되어 있으므로, s1, s3, s4의 수신 및 발신 흐름 전달 규칙은 영향을 받지만 s2의 동작은 변경되지 않는다.
- OpenFlow가 통신 계층 프로토콜로 사용된다.
- 컨트롤 플레인은 링크 상태 라우팅 외에 다른 기능은 수행하지 않는다.
### 동작 과정
1. 스위치 s1은 s2와의 링크 장애를 겪고, OpenFlow `port-status` 메시지를 사용하여 SDN 컨트롤러에 링크 상태 변경을 알린다.
2. SDN 컨트롤러는 링크 상태 변경을 나타내는 `port-status` 메시지를 수신하고, 링크 상태 관리자에게 이를 알려 링크 상태 데이터베이스를 업데이트한다.
3. 다익스트라 알고리즘으로 링크 상태 라우팅을 구현하는 네트워크 제어 애플리케이션은 이전에 링크 상태 변경 시 통지 받도록 등록해 두었으므로, 링크 상태 변경을 통보 받는다..
4. 링크 상태 라우팅 애플리케이션은 링크 상태 관리자와 상호작용하여 업데이트된 링크 상태를 가져오고, 상태 관리 계층의 다른 구성 요소를 참조할 수도 있다. 그런 다음 새로운 최단 경로를 계산한다.
5. 링크 상태 라우팅 애플리케이션은 플로우 테이블 관리자와 상호작용하여 업데이트할 플로우 테이블을 결정한다.
6. 플로우 테이블 관리자는 OpenFlow 프로토콜을 사용하여 영향을 받는 스위치(s1, s2, s4)의 플로우 테이블 항목을 업데이트한다.
    - s1: 이제 s2로 가는 패킷을 s4를 경유하도록 라우팅한다.
    - s2: 이제 중간 스위치 s4를 경유하여 s1로부터 패킷을 수신하기 시작한다.
    - s4: 이제 s1에서 s2로 가는 패킷을 전달해야 한다.

