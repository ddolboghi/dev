> [!NOTE]
> 구현을 먼저 알고 개념 수준인 OSI 7 layer를 알아야한다.

> [!tip]
> - 인터넷은 라우터의 집합체다.
> - 라우터는 L3 switching을 한다.

# 네트워크 계층

![[img/네트워크 기본]]
- DoD는 미방위성이 정한 네트워크 구조
- Access 식별자는 MAC 주소
- Network 식별자는 IP 주소
- Transport 식별자는 Port 번호 
- Application의 구현은 응용프로그램이다.
- kernel의 구성요소는 파일 형태로 application에 추상화된다.
- kernel의 구성요소 중 network와 관련된 것들의 추상화된 파일은 Socket이다.
- TCP/IP Socket은 user mode application process가 TCP에 접근할 수 있도록 파일 형태로 추상화한 인터페이스가 속한 것이다.
# MAC 주소, IP 주소, Port 번호가 식별하는 것
## MAC 주소
- NIC(LAN 카드)의 식별값이다.
- NIC 하나 당 한 개의 MAC 주소를 가진다.
- 칩을 바꾸지 않고 **변경 가능하다.**
## IP 주소
- Host(인터넷에 연결된 컴퓨터)의 식별자다.
- 하나의 컴퓨터는 여러 IP 주소를 가질 수 있다.
- NIC에 N개의 IP 주소를 바인딩할 수 있다.
## Port 번호
- user mode는 Process로 인식한다.
- kenel은 Service로 인식한다.
- H/W는 인터페이스 번호로 인식한다.
# IPv4 주소 체계
- IP(Internet Protocol)
- IPv4는 32bit 주소 체계(길이)
	- IP v4 주소는 약 43억개($2^{32}$)
- IPv6는 128bit 주소 체계(길이)
- IPv4 주소는 8bit 씩 끊어서 표시한다.
- 192.168.60.14에서 192를 이진수로 변환하면 $1100 0000_{(2)}$ -> c 0
- network id와 host id는 IPv4의 클래스에 따라 다르다.
- net mask(subnet mask)는 network id의 길이(bit)다.
	- host id를 0으로 반환하여 IP 주소의 network id값을 반환한다.
- IPv4와 net mask를 bit and 연산하면 network id가 나온다.
- IPv4를 192.168.60.14/24로 표기한다.
## 클래스 기반 주소
- 클래스 A: 네트워크 prefix bit = 8, 44.0.0.1에서 44는 네트워크 주소이고 0.0.1은 호스트 주소
- 클래스 B: 네트워크 prefix bit = 16, 128.16.0.2에서 128.16은 네트워크 주소이고 0.2는 호스트 주소
- 클래스 C: 네트워크 prefix bit = 24, 192.168.1.100에서 192.168.1은 네트워크 주소이고 100은 호스트 주소
### 클래스 기반 주소의 단점
- 사용하지 않는 IP주소가 낭비되므로 비효율적이다.
- 클래스마다 서브넷 마스크가 고정되있기 때문에 다른 network id를 가진 IP주소라도 같은 클래라면 결합할 수 없다. 
## CIDR
- Classless Inter-Domain Routing주소는 가변 길이 서브넷 마스킹(VLSM)을 사용해 네트워크와 호트 주소 비트간의 비율을 변경한다.
- 192.0.2.0/24는 처음 24bit 또는 192.0.2가 network id인 IPv4 CIDR 주소
### CIDR의 장점
- IP 주소 낭비 감소
	- 필요한 수의 IP 주소만 사용해 낭비를 줄일 수 있다.
	- 라우팅 테이블 항목이 줄어들고 데이터 패킷 라우팅이 단순화된다.
- 데이터를 빠르게 전송
	- 라우터에서 보다 효율적으로 IP주소를 여러 서브넷으로 구성할 수 있다.
	- CIDR을 사용하면 여러 서브넷을 만들고 통합할 수 있다. 이렇게 하면 불필요한 경로를 사용하지 않고도 데이터가 대상 주소에 도달할 수 있다.
> [!tip]
> subnet: 네트워크 내에 있는 소규모 네트워크. 라우터에 연결된 모든 디바이스는 동일한 subnet에 있고 동일한 IP 주소 prefix를 사용한다.
- VPC(Virtual Private Cloud) 생성
	- VPC는 클라우드 내에서 호스팅되는 private 디지털 공간이다.
	- VPC를 사용하면 격리되고 안전한 환경에 워크로드를 제공할 수 있다.
	- VPC는 연결된 디바이스 간에 데이터 패킷을 전송할때 CIDR을 사용한다.
- super net을 유연하게 생성
	- super net은 유사한 네트워크 접두사를 가진 서브넷의 그룹이다.
	- CIDR을 사용하면 super net을 유연하게 만들 수 있다.
			- 192.168.1/23과 192.168.0/23은 255.255.254.0이라는 subnet mask를 IP주소에 적용한다. 처음 23bit를 network id로 반환하므로 라우터는 단 하나의 라우팅 테이블 항목으로 서브넷에 있는 디바이스 간의 데이터 패킷을 관리할 수 있다.
### CIDR 작동방식
- 라우터는 클래스에 따라 IP 주소를 분류하는 대신 CIDR 접미사에 지정된 network id 및 host id를 검색한다.
- 네트워크 라우터에서 표시된 서브넷에 따라 해당하는 디바이스로 데이터 패킷을 라우팅할 수 있다.
### CIDR 블록
- 동일한 네트워크 접두사와 비트 수를 공유하는 IP 주소 모음이다.
- 블록이 클수록 더 많은 IP 주소를 가지고 network id 길이가 작아진다.
- Internet Assigned Numbers Authority(IANA)에서는 지역 인터넷 레지스트리(RIR)에 대규모 CIDR 블록을 할당한다. 그러면 RIR은 로컬 인터넷 레지스트리(LIR)에 더 작은 블록을 할당한 후 조직에 할당한다. 반면, 개인 사용자는 인터넷 서비스 공급자에 CIDR 블록을 신청한다.
### IPv6에서 CIDR
- IPv4와 똑같이 bit 길이를 `/`뒤에 표시한다.
- 2001:0db8:/32는 처음 32비트 또는 2001:db8을 네트워크 주소로 사용하는 IPv6 CIDR 주소다.

[참고](https://aws.amazon.com/ko/what-is/cidr/)

# 네트워크 Switch와 Switching
- Switch: 네트워크에서 데이터 패킷이 가는 길목에 있는 교차로로, 라우터다.
	- 교차로(라우터)에서 갈 수 있는 여러 경로가 네트워크 인터페이스다.
- Switching: 가야할 경로(인터페이스)를 선택하는 것
- 라우터들간 통신을 통해 최적화된 경로를 정한다.
- 데이터 패킷이 라우터에 도착하면 경로 선택 스위칭을 한다. 이때 **라우팅 테이블**을 통해 최적 경로로 간다.
# 네트워크 데이터 단위
- socket은 stream(프로그램에 따라 길이가 달라지는 형태)
- TCP는 segment 단위
- IP는 packet 단위
- driver 이하는 frame 단위
1. user mode의 애플리케이션 계층의 프로세스가 file(socket)에 stream 데이터를 write한다.
2. kernel mode의 TCP계층에서 stream 데이터를 일정 길이만큼segmentation(분해, 자르기)한다.
	- segment의 최대 크기를 Maximum Segment Size(MSS)라고 한다.
	- packet의 최대 크기를 Maximum Transport Unit(MTU)라고 한다.
	- MSS는 MTU에 의해 정해진다.
	- MTU는 최대 1500 byte(1.5KB)다.
	- MSS는 MTU보다 작다.
	- 1.5MB의 file을 전송하기 위해서는 약 1000개의 packet이 필요하다.
	- packet은 frame으로 encapsulation된다.
3. IP 계층에서 segment는 인터넷 환경에서 전송 가능한 형태인 packet으로 포장된다.
4. packet을 아래 계층으로 전달할때 frame에 넣는다.
# 네트워크 인터페이스 선택 원리와 기준

![[네트워크 인터페이스 선택 원리]]
- 유선 네트워크 1개와 무선 네트워크 1개에 연결되있다면 host의 ip주소는 2개다.

1. 크롬을 실행하면 socket이 열린다.
2. TCP/IP binding
3. NIC를 제어하는 디바이스 드라이버가 작동한다.

- 연결된 네트워크 인터페이스가 여러 개일때 하나를 선택하는 걸 switching이라고 한다.
> [!tip] 
> `route PRINT` 명령어를 실행하면 컴퓨터의 라우팅 정보가 나온다.

> [!NOTE]
> 어떤 ip 주소는 어떤 네트워크 인터페이스와 연결된다.

- pc는 Metric 값으로 네트워크 인터페이스를 선택한다.
- Metric은 인터넷에 접근하는 비용이라고 생각할 수 있다.
- 비용이 적게 드는 인터페이스를 선택한다.
# 웹서비스 구조
## 탄생 배경
- CERN 연구원 티모시 버너스 리가 텍스트로만 이뤄진 문서에 링크를 넣어 확장하기 위해 HTML과 HTTP를 만들고, 이로써 web을 창안했다. 그리고 web service를 만들었다.
- web 형태로 논리적으로 이어진 문서들을 web service라고 한다.
- 문서를 다루는 모든 SW들은 데이터를 제어하고, 보여주는 인터페이스가 연결되있다.
- SW(웹서비스)는 인터페이스 + 제어 체계 + 데이터로 이뤄져있다.
## 초창기 웹서비스 구조
- 문서를 다루는 프로그램은 자료구조(문서) + UI + 제어체계로 구성된다.
- 3가지로 나누는 이유는 유지보수 편의성을 극대화하기 위해서다.
- web client(브라우저)와 web server가 TCP/IP 연결을 통해 HTTP 통신을 한다.
> [!tip]
> - HTTP는 **stateless**하다.
> - TCP/IP 연결은 상태가 있다.
- web client와 web server는 각자의 IP 주소를 가지고 있고, 서로 주소를 알고 TCP/IP 연결을 한 다음, HTTP통신에서 URL로 Resource(문서)를 찾는다.
- DNS에서 URL에 해당하는 IP 주소(web server)를 찾는다. 
- web client에서 http.request가 가면 web server에서 http.response로 문서를 준다.
	- http.request는 여러 방법론(method)이 있다.
	 ex) http.request.method == GET
- 브라우저는 HTML을 구문분석(parsing)한다.
- 구문분석하면 비선형 트리 자료구조인 DOM이 형성된다.
- DOM을 화면에 렌더링한다.
- 브라우저를 이루는 핵심요소는 구문분석기와 렌더링 엔진이다.