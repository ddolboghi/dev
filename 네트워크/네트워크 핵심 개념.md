> [!NOTE]
> 구현을 먼저 알고 개념 수준인 OSI 7 layer를 알아야한다.

> [!tip]
> - 인터넷은 라우터의 집합체다.
> - subnet: 네트워크 내에 있는 소규모 네트워크. 라우터에 연결된 모든 디바이스는 동일한 subnet에 있고 동일한 IP 주소 prefix를 사용한다.

# 기기가 네트워크에 연결되는 방법
- 컴퓨터에 인터넷을 연결할때는 흔히 Ethernet 케이블 또는 와이파이로 홈라우터에 연결하는 방식을 사용한다.
- 모바일 기기는 대부분 Ethernet 대신 wifi나 모바일 네트워크, 위성 네트워크를 사용한다.
# 네트워크 종류
- 중앙집중식 네트워크는 여러 클라이언트가 하나의 라우터에 연결되는 네트워크다.
- 비집중식 네트워크는 여러 클라이언트가 여러 라우터에 연결되어 있고, 이 라우터끼리 서로 연결된 형태다.
- 분산 네트워크는 모든 노드가 계층 없이 서로 연결되있어, 중앙 노드 없이 모든 노드가 동등하고 서로 직접 소통할 수 있다.
# 네트워크 계층

![[img/네트워크 기본]]
- DoD는 미방위성이 정한 네트워크 구조
- Access 식별자는 MAC 주소
- Network 식별자는 IP 주소
- Transport 식별자는 Port 번호 
- Application의 구현은 응용프로그램이다.
- kernel의 구성요소는 파일 형태로 application에 추상화된다.
- kernel의 구성요소 중 network와 관련된 것들의 추상화된 파일은 Socket이다.
- TCP/IP Socket은 user mode application process가 TCP에 접근할 수 있도록 파일 형태로 추상화한 인터페이스가 속한 것이다.
# MAC 주소, IP 주소, Port 번호가 식별하는 것
## MAC 주소
- Media Access Control Address
- NIC(LAN 카드)의 식별값이다.
- 48bit == 6 byte
- NIC 하나 당 한 개의 MAC 주소를 가진다.
- 칩을 바꾸지 않고 **변경 가능하다.**
> [!TIP]
> IMEI(International Mobile Equipment Identity)는 휴대폰 네트워크에서 MAC 주소 대신 사용하는 국제 이동 단말기 식별 번호다.
## IP 주소
- IP(Internet Protocol)는 패킷을 어떻게 구성할 것인지, 패킷을 목적지까지 보낼 주소를 어떻게 지정할 것인지 표준화하는 프로토콜이다.
- Host(인터넷에 연결된 컴퓨터)의 식별자다.
- 하나의 컴퓨터는 여러 IP 주소를 가질 수 있다.
- NIC에 N개의 IP 주소를 바인딩할 수 있다.
- IP 주소 할당 방식:
	- 정적 방식은 주소가 고정된다. 
	- 동적 방식은 주기적으로 주소가 바뀐다.
- 서버는 항상 같은 주소로 접근할 수 있어야하기 때문에 주로 정적 IP 주소를 사용한다.
## Port 번호
- user mode는 Process로 인식한다.
- kenel은 Service로 인식한다.
- H/W는 인터페이스 번호로 인식한다.
# IPv4
- IPv4는 32bit 길이며, 약 43억개($2^{32}$)의 주소를 사용할 수 있다.
- `.`으로 구분된 8bit 블록 4개로 구성된다.
- 192.168.60.14에서 192를 이진수로 변환하면 $1100 0000_{(2)}$ -> c 0
- network id와 host id는 IPv4의 클래스에 따라 다르다.
- net mask(subnet mask)는 network id(≈네트워크 주소)의 길이(bit)다.
	- host id를 0으로 반환하여 IP 주소의 network id값을 반환한다.
- IPv4와 net mask를 bit and 연산하면 network id가 나온다.
## 클래스 기반 주소
- 클래스 A: 
	- 네트워크 prefix bit = 8
	- 44.0.0.1에서 44는 네트워크 주소이고 0.0.1은 호스트 주소
- 클래스 B: 
	- 네트워크 prefix bit = 16 (8bit * 2)
	- 128.16.0.2에서 128.16은 네트워크 주소이고 0.2는 호스트 주소
- 클래스 C: 
	- 네트워크 prefix bit = 24 (8bit * 3)
	- 192.168.1.100에서 192.168.1은 네트워크 주소이고 100은 호스트 주소
### 클래스 기반 주소의 단점
- 사용하지 않는 IP주소가 낭비된다.
- 클래스마다 서브넷 마스크가 고정되있기 때문에 다른 네트워크 주소를 가진 IP주소라도 같은 클래스라면 결합할 수 없다. 
## CIDR
- Classless Inter-Domain Routing주소는 가변 길이 서브넷 마스킹(VLSM: Variable-length Subnet Mask)을 사용해 네트워크와 호트 주소 비트간의 비율을 변경한다.
- 192.0.2.0/24는 처음 24bit(192.0.2)가 network id인 IPv4 CIDR 주소
### VLSM
- 각 서브넷마다 가변 길이의 서브넷 마스크를 적용하는 기법이다.
- 호스트 수가 적은 네트워크에는 긴 서브넷 마스크, 호스트수가 많은 네트워크에는 짧은 서브넷 마스크를 적용할 수 있다.
- 동일 네트워크 주소공간에서, 다른 크기의 서브넷 사용을 허용한다.
- 만약 클래스 C 주소를 할당시 256개의 호스트 주소가 가능한데, 이보다 적은 수의 주소만 필요하다면 24보다 큰 서브넷 마스크를 적용하여 적은 수의 주소만 할당 할 수 있어 주소의 낭비를 막는다.
- 이미 서브넷으로 나누어진 네트워크 주소도 더 작은 서브넷으로 나눌 수 있다.
- 2개의 양단간 시리얼 네트워크도 이용 가능하다. 이때 prefix bit는 31을 사용하면 된다.(RFC 6164)
- 여러 서브넷으로 나누어진 네트워크를 하나의 네트워크 다시 묶어 표현할 수 있어 주소 축약(경로 요약)이 가능하다.
- VLSM을 사용하려면 이를 지원하는 라우팅 프로토콜이 필수적이다.(RIPv2, EIGRP, OSPF, IS-IS, BGP)
![[VLSM_example.png]]
위 그림에서 하나의 C급 classful network(128.3.2.0)하에서도, 1이상의 다른 길이의 서브넷 마스크(`/24`, `/25`)가 사용되된다. -> **이해안됨**
### CIDR의 장점
- IP 주소 낭비 감소
	- 필요한 수의 IP 주소만 사용해 낭비를 줄일 수 있다.
	- 라우팅 테이블 항목이 줄어들고 데이터 패킷 라우팅이 단순화된다.
- 데이터를 빠르게 전송
	- 라우터에서 보다 효율적으로 IP주소를 여러 서브넷으로 구성할 수 있다.
	- CIDR을 사용하면 여러 서브넷을 만들고 통합할 수 있다. 이렇게 하면 불필요한 경로를 사용하지 않고도 데이터가 대상 주소에 도달할 수 있다.
- VPC는 연결된 디바이스 간에 데이터 패킷을 전송할때 CIDR을 사용한다.
- super net을 유연하게 생성
	- super net은 유사한 네트워크 prefix를 가진 서브넷의 그룹이다.
	- CIDR을 사용하면 super net을 유연하게 만들 수 있다.
			- 192.168.1/23과 192.168.0/23은 255.255.254.0이라는 subnet mask를 IP주소에 적용한다. 처음 23bit를 network id로 반환하므로 라우터는 단 하나의 라우팅 테이블 항목으로 서브넷에 있는 디바이스 간의 데이터 패킷을 관리할 수 있다.
### CIDR 작동방식
- 라우터는 클래스에 따라 IP 주소를 분류하는 대신 CIDR 접미사에 지정된 network id 및 host id를 검색한다.
- 네트워크 라우터에서 표시된 서브넷에 따라 해당하는 디바이스로 데이터 패킷을 라우팅할 수 있다.
### CIDR 블록
- 동일한 네트워크 접두사와 비트 수를 공유하는 IP 주소 모음이다.
- 블록이 클수록 더 많은 IP 주소를 가지고 network id 길이가 작아진다.
- Internet Assigned Numbers Authority(IANA)에서는 지역 인터넷 레지스트리(RIR)에 대규모 CIDR 블록을 할당한다. 그러면 RIR은 로컬 인터넷 레지스트리(LIR)에 더 작은 블록을 할당한 후 조직에 할당한다. 반면, 개인 사용자는 인터넷 서비스 공급자에 CIDR 블록을 신청한다.
### IPv6에서 CIDR
- IPv4와 똑같이 bit 길이를 `/`뒤에 표시한다.
- 2001:0db8:/32는 처음 32비트 또는 2001:db8을 네트워크 주소로 사용하는 IPv6 CIDR 주소다.

[참고](https://aws.amazon.com/ko/what-is/cidr/)
# IPv6
- IPv6의 길이는 128bit로, 약 304간 2823구($2^{128}$)개의 주소를 할 수 있다.
- `:`로 구분된 16bit 블록 8개로 이뤄져있다.
- 16진수로 표기한다. 이때, 0만으로 구성된 블록이 연속되면 `:`만 표시한다.

| 이진수 표기      | 0010000000000001:0000110110111000:<br>0000000000000000:0000000000000001:<br>0000000000000000:0000000000000000:<br>0000000000010000:0000000111111111 |
| ----------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| 16진수 표기     | 2001:0DB8:0000:0001:0000:0000:0010:01FF                                                                                                             |
| 16진수 표기 축약형 | 2001:0DB8:0000:0001::0010:01FF                                                                                                                      |
- IPv6를 사용하는 디바이스는 홈라우터에 연결할때 모두가 접근할 수 있는 주소를 여러 개 할당받을 수 있다.
# IPSec
- Internet Protocol Security는 데이터 패킷의 무결성(confidentiality), 진본성(authenticity), 신뢰성을 보장하는 다양한 방식을 통틀어 이르는 말이다.
- 패킷을 확인하는 과정을 암호화해서 무결성과 진본성을 확보한다.
- 발신 주소를 수정하거나 훼손하지 못하게 막는다.
- 패킷 내용을 암호화해 신뢰성을 보장한다.
- IPSec을 사용하는 디바이스나 라우터는 신뢰할 수 없거 유효하지 않은 것으로 보이는 패킷을 모두 배제한다.
- IP spoofing, DDoS 공격을 막을 수 있다.
# 네트워크 Switch와 Switching
- Switch: 네트워크에서 데이터 패킷이 가는 길목에 있는 교차로로, 라우터다.
	- 교차로(라우터)에서 갈 수 있는 여러 경로가 네트워크 인터페이스다.
- Switching: 가야할 경로(인터페이스)를 선택하는 것
- 라우터들간 통신을 통해 최적화된 경로를 정한다.
- 데이터 패킷이 라우터에 도착하면 경로 선택 스위칭을 한다. 이때 **라우팅 테이블**을 통해 최적 경로로 간다.
# 네트워크 데이터 단위
- socket은 stream(프로그램에 따라 길이가 달라지는 형태)
- TCP는 segment 단위
- IP는 packet 단위
- driver 이하는 frame 단위
1. user mode의 애플리케이션 계층의 프로세스가 file(socket)에 stream 데이터를 write한다.
2. kernel mode의 TCP계층에서 stream 데이터를 일정 길이만큼segmentation(분해, 자르기)한다.
	- segment의 최대 크기를 Maximum Segment Size(MSS)라고 한다.
	- segment가 encapsulation되면 packet이 된다.
	- packet의 최대 크기를 Maximum Transport Unit(MTU)라고 한다.
	- MSS는 MTU에 의해 정해진다.
	- MTU는 최대 1500 byte(1.5KB)다.
	- MSS는 MTU보다 작다.
	- 1.5MB의 file을 전송하기 위해서는 약 1000개의 packet이 필요하다.
	- packet은 frame으로 encapsulation된다.
	- ethernet network면 ethernet frame이라고 부른다.
1. IP 계층에서 segment는 인터넷 환경에서 전송 가능한 형태인 packet으로 포장된다.
2. packet을 아래 계층으로 전달할때 frame에 넣는다.
# 네트워크 인터페이스 선택 원리와 기준

![[네트워크 인터페이스 선택 원리 | 800]]
- 유선 네트워크 1개와 무선 네트워크 1개에 연결되있다면 host의 ip주소는 2개다.

1. 크롬을 실행하면 socket이 열린다.
2. TCP/IP binding
3. NIC를 제어하는 디바이스 드라이버가 작동한다.

- 연결된 네트워크 인터페이스가 여러 개일때 하나를 선택하는 걸 switching이라고 한다.
> [!tip] 
> `route PRINT` 명령어를 실행하면 컴퓨터의 라우팅 정보가 나온다.

> [!NOTE]
> 어떤 ip 주소는 어떤 네트워크 인터페이스와 연결된다.

- pc는 Metric 값으로 네트워크 인터페이스를 선택한다.
- Metric은 인터넷에 접근하는 비용이라고 생각할 수 있다.
- 비용이 적게 드는 인터페이스를 선택한다.
# 웹서비스 구조
## 탄생 배경
- CERN 연구원 티모시 버너스 리가 텍스트로만 이뤄진 문서에 링크를 넣어 확장하기 위해 HTML과 HTTP를 만들고, 이로써 web을 창안했다. 그리고 web service를 만들었다.
- web 형태로 논리적으로 이어진 문서들을 web service라고 한다.
- 문서를 다루는 모든 SW들은 데이터를 제어하고, 보여주는 인터페이스가 연결되있다.
- SW(웹서비스)는 인터페이스 + 제어 체계 + 데이터로 이뤄져있다.
## 초창기 웹서비스 구조
- 문서를 다루는 프로그램은 자료구조(문서) + UI + 제어체계로 구성된다.
- 3가지로 나누는 이유는 유지보수 편의성을 극대화하기 위해서다.
- web client(브라우저)와 web server가 TCP/IP 연결을 통해 HTTP 통신(≈HTTP 1.0)을 한다.
> [!tip]
> - HTTP는 **stateless**하다.
> - TCP/IP 연결은 상태가 있다.
- web client와 web server는 각자의 IP 주소를 가지고 있고, 서로 주소를 알고 TCP/IP 연결을 한 다음, HTTP통신에서 URL로 Resource(문서)를 찾는다.
- DNS에서 URL에 해당하는 IP 주소(web server)를 찾는다. 
- web client에서 http.request가 가면 web server에서 http.response로 문서를 준다.
	- http.request는 여러 방법론(method)이 있다.
	 ex) http.request.method == GET
- 브라우저는 HTML을 구문분석(parsing)한다.
- 구문분석하면 비선형 트리 자료구조인 DOM이 형성된다.
- DOM을 화면에 렌더링한다.
- 브라우저를 이루는 핵심요소는 구문분석기와 렌더링 엔진이다.
- 초창기 브라우저는 당시 문서뷰어와 달리 **원격지** 문서뷰어였다.
- HTML, CSS, 사진은 정적(static)이다.
- HTML > CSS > 사진 순서로 렌더링한다.
## 웹서비스 3대 요소
- http.request.method == GET은 web server로부터 문서를 읽어오는 단방향 작용이다.
- web server는 송수신 담당만 하고, web client로부터 받은 데이터를 처리 및 연산하는 web application server로 넘긴다.
- web client에서 사용자가 입력하면 web server로 http.request.method == POST 등이 가서 양방향 상호작용을 한다.
- web client와 web server가 양방향 상호작용을 하면서 데이터가 상태를 가지고, 변하기 시작했다.(전이)
- HTTP는 stateless하기 때문에 데이터의 상태, 전이를 기록할 수 없다.
- 데이터베이스로 데이터의 상태, 전이를 기록하기 시작했다.
- web application server는 데이터베이스에서 데이터를 찾아 문서에 넣어서 응답한다.
	- 동적으로 생성된 문서다.
- 브라우저가 연산할 수 있게 엔진을 추가했다.
- 연산 주체인 script 엔진은 mocka -> live -> javascript로 발전했다.
- **js는 브라우저에서 실행된다.**
- 정적 파일은 HTML, CSS, 사진, JS로 구성된다.
- web client는 **cookie**를 이용해 데이터를 기억한다.
- cookie는 key-value 구조이며 각 쌍에 대해 여러 속성(범위, 기간)이 있다.
## LAN과 WAN을 구별하는 방법
- Local Area Network ≈ H/W 영역, 물리적, MAC, broadcast 트래픽이 도달하는 범위
- Wide Area Network ≈ S/W 영역, Virtual networks
- 인터넷은 가상 네트워크(Virtual networks)이고, 전세계가 사용하는 WAN이다.
- WAN은 logical 영역, 즉 소프트웨어 영역에서 설명될 수 있다.
- WAN은 IP 주소를 기반으로 작동하는 네트워크라고 생각할 수 있다.
- LAN은 하드웨어 영역의 1, 2 계층으로 이해할 수 있다.
- 2 계층의 MAC 주소에 기초해서 작동하는 네트워크를 LAN이라고 생각할 수 있다.
- IP 주소와 MAC 주소에서 broadcasting 주소가 적용되는 범위를 LAN이라고 생각할 수 있다.
# 패킷의 생성 원리와 캡슐화
## 패킷 구성과 캡슐화
- 패킷은 0과 1로 이루어진 이진수 데이터로 구성된다.
- 패킷 1개는 최대 1500bytes이며, 이를 MTU(Maximum Transport Unit)라고 한다.
- 패킷은 header와 payload로 구성된다.
- 패킷은 택배고, header는 송장, payload는 내용물이다.
- header는 [IP | TCP] 기본적으로 각각 20bytes로 이뤄져있다.
- payload는 1460bytes이며, 이를 MSS(Maximum Segment Size)라고 한다.
- 내용물을 택배 상자에 넣는걸 encapsulation이라고 한다.
- frame은 택배를 싣는 트럭으로, 여러 packet을 encapsulation한다.
- 패킷의 payload를 까보는걸 DPI(Deep Packet Inspection)이라고 한다.
## 패킷 생성 원리
1. 프로세스가 socket에 입출력을 시도한다.
2. 메모리에 저장된 stream형태의 데이터를 segment화한다.(L4)
3. segment를 encapsulation해서 packet으로 만든다.(L3)
4. 여러 packet을 encapsulation하면 frame이 된다.(L2)
## 패킷 전송
- 이진수 신호는 송신기에서 주파수 변조(FM: Frequency Modulation)를 거쳐 전송된다.
- 수신기는 주파수를 이진수로 변환한다.

# L2 스위치
- L2 스위치는 MAC 주소로 스위칭하는 것이다.
![[L2 스위치]]
- end point와 직접 연결되는 L2 스위치를 L2 access 스위치라고 한다.
- L2 access 스위치에 연결된 pc들끼리 정보를 주고받을 수 있다.
- L2 distribution 스위치에 연결된 L2 access를 통해 pc1, 2와 pc 3, 4가 정보를 주고받을 수 있다.
- L2 distribution 스위치에는 pc가 직접 연결될 수도 있지만, 보통 스위치를 위한 스위치 역할이다.
- L2 distribution는 일반적으로 router와 연결된다.
- router는 게이트웨이 역할을하며, 인터넷과 연결된다.
- 공유기 같은 곳에서 LAN 케이블을 연결하는 포트는 L2 스위치 인터페이스다.
- LAN 포트에서 uplink용 포트를 제외한 나머지 포트를 pc에 연결할 수 있다.
> [!info]
> - uplink: 상위 계층의 스위치로 연결되는 라인

> [!info]
> - Link-up: 물리적으로 LAN 케이블에 연결됨
> - Link-down: 물리적으로 LAN 케이블 연결 끊김
# IP 헤더 형식과 의미
![[IPv4_Packet-en.svg]]
- IPv4 packet의 헤더는 기본적으로 20bytes다.
- data는 Total length = 16bit이므로 최대 $2^{16}$ = 64KB이다.
- Version = 4bit이므로 IPv4다.
- IHL(Internet Header Length) = 5
- ${4bytes}\times{IHL}$ = IP packet 헤더의 길이
	- 4bytes는 헤더 가로 길이
	- $4\times5$ = 20bytes
	- Options이 있다면 20bytes보다 커진다.
- TOS(Type Of Service)는 요구되는 서비스 품질을 나타낸다.
	- 서비스 유형과 혼잡 알림을 나타낸다.
	![[Pasted image 20240814131731.png]]
    - bit 0-2: Precedence (우선순위 8단계)
       . 000 : Routine (Normal)
       . 001 : Priority
       . 010 : Immediate
       . 011 : Flash
       . 100 : Flash Override
       . 101 : Critical
       . 110 : Internetwork Control
       . 111 : Network Control
	- bit 3: Delay 
		- 0: 보통의 지연
		- 1: 높은 지연
	- bit 4: Throughput(처리율)
		- 0: 보통 처리율
		- 1: 높은 처리율
	- bit 5: Reliability(신뢰성)
		- 0: 보통 신뢰성
		- 1: 높은 신뢰성
	- bit 6: minimum Cost(최소 비용)
	- bit 7은 항상 0이다.
- Identification, Flags, Fragment Offset은 단편화와 관련있다.
	- 예를들어, MTU가 1400bytes인 경우 보내는 데이터가 1500bytes면 이를 쪼개는데, 이를 단편화라한다.
	- 단편화를 하면 쪼개고 다시 합쳐야 하기때문에 안해야 좋다.
- TTL(Time To Live)은 IP packet의 수명이다.
	- packet이 라우팅되며 거쳐야할 남은 라우터의 개수다.
	- TTL 값은 최대 255인 8bit의 홉 한계를 갖는다.
	- 라우터를 지날때마다 TTL은 1씩 감소한다.
	- TTL == 0이면 라우터는 해당 packet을 버린다.
- Protocol은 data내에 어느 상위계층 프로토콜(L4의 헤더)가 포함되있는지 보여준다.
	- TCP = 6
- Header checksum은 전송 과정에서 오류가 있는지 확인하는 값이다.
	1. 송신측에서 전송할 모든 데이터를 16bit단위로 구분하고
	2. 1의 보수를 취하고 그 합에 대한 결과를 전송하면
	3. 수신측에서 같은 합을 해보고 오류를 검출한다.
	- 순서가 바뀌는 오류는 검출하지 못한다.
	- L2 계층에서는 CRC로 대체되고 있다.
	- IPv6 헤더에는 checksum 필드가 없다.
	- 전송계층의 TCP헤더나 UDP헤더 등에 일부 사용된다.
- [Options](http://ktword.co.kr/test/view/view.php?m_temp1=1900&id=425)을 통해 제어/시험/디버깅이 가능하지만 통신 그 자체에는 관여하지 않는다.
# 라우터
- 라우터는 IP 패킷을 한 네트워크에서 다른 네트워크로 옮기는 역할을 한다.
- 라우터는 MAC 주소를 사용해서 연결하려는 기기를 식별한다.
- 라우터는 L3 switching을 한다.
- 인터넷에 사설망이 연결되고 라우터를 거쳐 패킷을 보낼때, 라우터는 네트워크 주소 변환(NAT: Network Address Translation)을 활용해 패킷의 주소 형식을 다시 작성한다. 간단히 말하면 LAN에서만 통하는 사설 IP 주소를 공용 IP 주소로 바꾸는 것이다.
	1. 라우터는 패킷 발신 측 정보를 모두 메모리에 저장한다.
	2. 네트워크가 인터넷으로부터 응답을 받으면 라우터는 수신한 패킷 태그를 다시 작성한다.
	3. 패킷을 라우터 메모리에 기록된 사설 IP로 발송한다.
	4. 디바이스가 패킷을 수신한다.
- **NAT은 IPv4에서만 사용한다.**
# 프로토콜
- TCP(Transmission Control Protocol: 전송 제어 프로토콜)은 패킷을 정확하고 완전한 형태로 전송하지만 속도가 느다.
- UDP(User Datagram Protocol)는 정확한 패킷 전달이나 전송 순서보다 속도를 우선시하는 프로토콜이다.
- QUIC(Quick UDP Internet Connection)는 여러 개의 빠른 UDP 연결을 활용하면서도 TCP처럼 정확하고 신뢰할 수 있는 방식으로 데이터를 전송한다.
## 경계 경로 프로토콜(BGP)
- BGP(Border Gateway Protocol)은 인터넷에서 주 경로 지정을 담당하는 프로토콜이다.
- BGP는 IP 패킷 라우팅 정보가 인터넷을 통해 AS사이에서 교환되는 방식을 정의한다.
> [!NOTE]
> AS(Autonomous System)는 자율 시스템이라는 뜻으로, 수만 개의 작은 네트워크를 의미한다.
- BGP는 한 지점에서 다음 지점으로 패킷을 목적지까지 전달할때 가장 짧고 비용(transit)이 저렴한 경로를 계산할 수 있다.
- 가능한 모든 경로를 보유한 BGP 서버는 거의 없다.
- AS의 출입구 역할을 하는 라우터를 BGP 라우터라고 한다.
## 전송 프로토콜
- 발신 측에서 데이터를 작은 크기로 분할하고, 수신 측에서 다시 합치도록 해주는 프로토콜이다.
### UDP(User Datagram Protocol)
- 데이터그램은 작은 단위의 데이터라는 뜻이다.
- UDP는 신뢰성, 정확성보다 **속도**를 우선한다.
	- 패킷이 목적지에 도착했는지, 올바른 순서로 도착했는지, 중간에 분실되었는지 신경쓰지 않는다.
- 패킷이 대상 주소에 도달했을때, 어떤 소프트웨어로 처리해야하는지 알려주는 정보를 데이터 전송에 추가한다.
- 영상 통화, 동영상 스트리밍, 온라인게임, 인터넷 전화(VoIP)처럼 빠르게 데이터를 전달하는게 중요하고, 지연된 패킷을 기다리거나 오류를 수정할 필요 없는 경우에 많이 활용된다.
1. UDP는 **소스 포트 번호**와 **대상 호스트의 포트 번호**가 포함된 헤더를 각 데이터그램에 추가한다.
2. 데이터가 분할되면 UDP는 데이터그램을 개별적으로 IP 소프트웨어에 보낸다.
3. 소프트웨어는 각 데이터그램을 패킷으로 압축한 다음 인터넷을 통해 목적지로 보낸다. 이때 'UDP 소스-대상 주소 체계'가 사용된다.
### TCP(Transmission Control Protocol)
- 전송 제어 프로토콜로, 데이터가 오류 없이 정확한 순서로 전송되도록 보장한다.
- 속도가 느리다.
- TCP는 오류를 수정할 수 있고, 패킷이 도착하면 순서를 정렬하고 검사할 수 있다.
- 두 애플리케이션 간 TCP로 패킷을 보내려한다면, TCP는 양방향으로 데이터를 보낼 수 있도록 둘의 노드에 통신 채널(**pipe** 또는 **stream**이라 부름)을 구축한다.
#### 파이프 안에서 일어나는 과정:
1. TCP는 애플리케이션이 데이터를 분할한 segment에 전송과정을 추적할 수 있도록 번호를 매긴다.
2. TCP는 모든 segment를 개별적으로 IP 소프트웨어에 전송한다. 그러면 각 segment가 패킷으로 압축된다.
3. TCP는 대상 호스트가 수신한 세그먼트를 다시 전달받아서 세그먼트에 매긴 번호를 토대로 패킷이 제대로 전송되었는지 확인한다.
#### 3 Way-Handshake
- TCP의 패킷 전달 방식
- 데이터 발신 및 수신이 필요할때마다 수행한다.
- TCP 연결이 암호화되어 있다면 더 많은 handsahake 과정이 필요하다.
> [!tip]
> SYNchronized(동기화)
> ACKnowledge(인식)
> FINalized(마무리)
1. 전송 시작할때 애플리케이션이 SYN-SYN / ACK-ACK라는 명령과 함께 패킷을 보낸다.
2. 수신 측에서 SYN, ACK 응답을 받으면 전송을 시작한다.
3. 수신 측에서 발송된 패킷을 인지하지 못하거나 패킷이 훼손되었다고 응답하면 발신측 TCP에서 해당 패킷을 재전송한다. 이때 다른 패킷은 전송 대기상태가 된다.
4. 발신 측 애플리케이션이 모든 패킷을 전달하면 수신 측 애플리케이션은 이를 하나씩 풀어서 원래 순서대로 정렬한다.
5. 발신 측 애플리케이션이 FIN-FIN / ACK-ACK라는 명령과 함께 패킷을 보낸다.
6. 수신 측 애플리케이션에서 패킷을 받고 연결을 종료한다.
### QUIC(Quick UDP Internet Connections)
- UDP와 TCP의 장점만 취한 프로토콜이다.
- 기본적으로 UDP를 사용해서 패킷을 보낸다.
- QUIC 데이터그램에는 수신 측에서 활용할 수 있는 QUIC 프로토콜 정보가 포함되있어, 수신된 데터그램을 추적하고 순서를 맞출 수 있다.
- QUIC 데이터그램에는 TCP 파이프의 신뢰성을 확보하기 위해 connection ID가 포함되있다.
	- connection ID는 IP가 바뀌어도 발신자나 수신자가 서로 알아보고 연결을 유지해주는 역할을 한다.
- QUIC 패킷은 기본적으로 암호화되있어 중개 노드가 패킷에 접근하거나 콘텐츠를 변조하지 못하도록 막는다.
- QUIC 데이터그램에는 connection ID, 패킷 번호, 암호화된 데이터가 있고, UDP 데이터그램이 QUIC 데이터그램을 포함한다. 그리고 IP 패킷이 UDP 데이터그램을 포함한다.
- QUIC는 TCP처럼 단일 스트림에 의존하지 않아 오류가 수정될때까지 기다리지 않고 나머지 데이터를 처리할 수 있다.
- TLS를 기본으로 사용한다.
# DNS
- Domain Name System은 공개적이고 분권화된 데이터베이스로, 숫자가 아닌 문자 형식의 고유한 이름을 IP 주소, 위치, 기타 데이터와 연결할 수 있다.
- DNS는 UDP를 활용해 도메인 검색 요청을 보내고 이에 응답한다.
# HTTP
- Hypertext Transfer Protocol은 하이퍼텍스트를 교환하거나 전송할때 사용하는 프로토콜이다.
- 하이퍼텍스트란 하이퍼링크라는 논리적 링크를 사용해서 다른 노드의 콘텐츠를 참조하기 위해 구조화된 텍스트다.
- HTTP는 기본적으로 클라이언트-서버 모델을 사용하는 request-response 프로토콜이다.
- HTTP는 응용 계층에서 작동하며, 웹 브라우저와 웹 서버간 통신 프로토콜이다.
- 실제 데이터 전송은 TCP로 이뤄진다.
- HTTP 자체는 암호화되지 않는다.
# HTTPS
- HTTPS = HTTP + TLS
- Hypertext Transfer Protocol Secure라고도 불린다.
- HTTPS는 TLS를 사용해 HTTP 메시지 본문과 헤더를 암호화된 봉투에 넣는다.
- 발신 및 대상 IP 주소는 암호화하지 않아 복호화하지 않아도 어느 노드가 서로 통신해야 하는지 알 수 있다.
- 클라이언트와 서버가 HTTPS 세션을 시작하기 전에 TLS handshake를 수행해야한다.
# TLS(Transport layer Security)
- 전송 중인 데이터의 프라이버시 확보
- 통신 노드의 ID 검증
- 데이터 분실 또는 변조를 예방하는 메시지 무결정 점검
- 서버와 클라이언트 간에 TLS 연결을 설정하려면 통신 노드가 handshake를 해서 공유 비밀 키를 구성해야 한다. 그러면 이 둘 사이에서 교환되는 모든 데이터가 암호화된다.
- TLS는 인증기관(CA. Certificate Authorities)에서 발급받은 디지털 인증서를 활용한다.
	- 인증서는 서비스 운영업체의 키 소유권을 증명한다.
	- 인증서에는 서버 이름, 소유자 ID, 공개키 사본, CA 암호화 서명 등의 정보가 들어있다.
	- 인증서는 단일 또는 복수의 도메인 이름에 모두 발급될 수 있다.
- 취약점: CA 자체가 훼손되거나 강제로 위조 인증서가 발급될 수 있다.
- 클라이언트 애플리케이션이 서버와 TLS handshake를 할때 신뢰할 수 있는 CA 목록과 인증서 서명이 자동으로 대조되어 올바른 서버와 통신하고 있는지 검증한다.
### TLS handshake
1. 클라이언트가 우선순위별로 지원되는 암호화 알고리즘 목록, 공개키를 서버에 보낸다.
	- SNI를 사용하면 요청 호스트 이름을 함께 보낸다.
2. 서버가 선택된 암호화 알고리즘과 서버 인증서를 클라이언트에 보낸다.
3. 클라이언트와 서버가 공유 비밀키를 구성한다.
## SNI(Server Name Indication)
- TLS의 확장 표준 중 하나로, 클라이언트가 서버에 요청하는 호스트의 이름을 알려준다.
- TLS handshake 과정 초반에 클라이언트가 어떤 서비스를 요청하는지 서버에 알려준다. 그러면 서버는 SNI에 맞는 인증서를 선택한다.
- 서버는 SNI에 따라 연결을 검열하거나 조사할 수 있다.

# 알아볼 것
- DHCP(Dynamic Host Configuration Protocol)를 통해 기기의 NIC에 네트워크 주소가 할당된다.
- 다양한 AS로 구성된 BGP 라우터가 통신하는 걸 세션이라고 한다.
- TCP 3 Way-Handshake, 4 Way-Handshake
- DOH는 HTTPS를 통한 DNS이며, TLS를 기본으로 사용한다.

읽네트워크 74p부터