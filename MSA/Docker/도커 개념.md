> [!info] 도커 엔진에서 사용하는 기본 단위는 이미지와 컨테이너이고, 이 두 가지가 도커 엔진의 핵심임

도커는 Go언어로 작성됨
# 도커 이미지
- 컨테이너를 생성할때 필요
- 이미지는 여러 개의 계층으로 된 바이너리 파일로 존재
- 도커 명령어로 이미지를 내려받을 수 있음
# 도커 컨테이너
- 도커 이미지로 컨테이너 생성
- 컨테이너는 이미지를 읽기 전용으로 사용
- 이미지에서 변경된 사항만 컨테이너 계층에 저장
- 컨테이너는 독립된 파일시스템을 가짐
- 컨테이너는 호스트와 분리돼 있어 다른 컨테이너와 호스트에 영향 안줌
# 명령어
> [!tip] 컨테이너를 대상으로하는 모든 명령어는 컨테이너명 대신 ID를 쓸 수 있음
> - ID는 중복되지 않는 앞의 3~4자리 써도 됨

> [!tip] 셸 출력 결과 깔금하게 보기
> - Go 템플릿 입력해서 원하는 정보만 출력
> ```bash
> docker ps --format "table {{.ID}}\t{{.Status}}\t{{.Images}}"
> ```

```
```


```bash
docker images
```
- 도커 엔진에 존재하는 이미지의 목록 출력

`-i`: 상호 입출력
`-t`: tty 활성화해 bash 셸을 사용하도록 설정

```bash
docker run -i -t [이미지:태그명]
```
- 이미지가 없다면 다운받아 컨테이너 생성 및 실행 후 컨테이너 내부로 들어감
- `exit`나 ctrl + D 로 컨테이너 셸에서 빠져나옴과 동시에 컨테이너를 정지시킴
- ctrl + P, Q는 컨테이너 셸만 빠져나옴

```bash
docker pull [이미지:태그명]
```
- 도커 공식 이미지 저장소에서 이미지를 내려받음

```bash
docker create -i -t --name [컨테이너 이름] [이미지:태그명] 
```
- 이미지가 없으면 이미지를 다운받고 컨테이너 생성

```bash
docker rename [기존 컨테이너 이름] [변경할 이름]
```

```bash
docker inspect [이미지명]
```
- 이미지 정보 출력

```bash
docker start [컨테이너명]
```
- 컨테이너 실행

```bash
docker attach [컨테이너명]
```
- `/bin/bash`로 실행한 컨테이너 셸에만 접속 가능
- 컨테이너에 직접 들어감

```bash
docker exec -it [컨테이너ID] /bin/bash
docker exec -it --name [컨테이너명] /bin/bash
```
- 외부에서 현재 실행 중인 컨테이너 셸에 접속

```bash
docker ps
```
- 정지되지 않은 컨테이너 출력
- `-a` 붙이면 모든 컨테이너 출력

![[docker_ps_a.png]]
- CONTAINER ID: 컨테이너 ID
- IMAGE: 컨테이너를 생성할때 사용된 이미지명
- COMMAND: 컨테이너가 시작될때 실행될 명령어. 대부분 내장됨. `docker run`, `docker create` 맨끝에 커맨드를 입력해서 덮어쓸 수 있음
	- `"/bin/bash"`: 상호 입출력이 가능한 커맨드
- CREATED: 컨테이너 생성된 후 흐른 시간
- STATUS: 컨테이너의 상태
	- `Up`: 실행 중
	- `Exited`: 종료
	- `Pause`: 일시중지
- PORTS: 컨테이너가 개방한 포트와 호스트에 연결한 포트 나열
- NAMES: 컨테이너의 고유한 이름. `--name`옵션으로 이름 안정하면 도커 엔진이 무작위로 설정함

```bash
docker stop [컨테이너명]
```
- 컨테이너 실행 중지

```bash
docker rm [컨테이너명]
```
- 컨테이너 삭제
- 컨테이너 실행 종료 후 삭제 가능
- `-f`를 끝에 붙이면 강제 삭제
- 한 번 삭제한 컨테이너는 복구할 수 없음

```bash
docker ps -a -q
```
- 모든 컨테이너들의 CONTAINER ID만 출력

```bash
docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)
```
- 모든 컨테이너를 정지하고 삭제
# 컨테이너를 외부에 노출하기
- 컨테이너는 가상 머신과 마찬가지로 가상 IP 주소(172.17.0.x)를 할당받음
- 외부에 컨테이너의 애플리케이션을 노출하려면 `eth0`의 IP와 포트를 호스트의 IP와 포트에 바인딩해야함

```
...:/# ifconfig
```
- 컨테이너의 네트워크 인터페이스 출력
![[container_network_interface.png]]
- `eth0`: 도커의 NAT IP를 할당받은 인터페이스
- `lo`: 로컬 호스트 인터페이스

- `docker inspect`에서 `"IPAddress"`: 컨테이너에 할당된 private IP로, 호스트 IP 및 포트와 바인딩하면 접속할 수 있는 URL

```bash
docker run -i -t --name [컨테이너명] -p [호스트의 포트]:[컨테이너의 포트] [이미지:태그명]
```
- `-p`로 컨테이너의 포트를 호스트의 포트와 바인딩해 연결
- 호스트의 특정 IP를 사용하려면 IP와 포트까지 명시
- `-p`를 여러 번 써서 여러 개의 포트를 외부에 개방할 수 있음
	```bash
	docker run -i -t -p 3306:3306 -p 192.168.0.100:7777:80 ubuntu:14.04
	```
- `-p [컨테이너 포트]`만 입력하면 호스트의 아무 포트와 연결되므로 `docker ps`로 PORTS 확인야함
## 아파치 웹서버 설치해 외부에 노출하기
```
...:/# apt-get update
...:/# apt-get install apache2 -y
...:/# service apache2 start
```

`localhost:[호스트 포트]`로 접속